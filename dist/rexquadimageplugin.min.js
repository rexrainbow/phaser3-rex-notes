var e,t;e=void 0,t=function(){const e=Phaser.GameObjects.Mesh;class t extends e{get tint(){return 0===this.vertices.length?16777215:this.vertices[0].color}forceUpdate(){return this.dirtyCache[10]=1,this}}const i=Phaser.Math.RotateAround;var s=function(e,t,s){var n=e.width/2,o=e.height/2;return r.x=t-n,r.y=s-o,i(r,0,0,e.rotation),r.x*=e.scaleX,r.y*=e.scaleY,r.x+=e.x,r.y+=e.y,r},r={x:0,y:0};class n{constructor(e,t){this.parent=e,this.vertex=t,this._localX=void 0,this._localY=void 0}destroy(){this.parent=void 0,this.vertex=void 0}updateVertexPosition(e,t){var i=this.parent,s=i.height,r=e/s-i.frame.cutWidth/s/2,n=t/s-i.frame.cutHeight/s/2,o=this.vertex;return o.x=r,o.y=-n,i.forceUpdate(),this}get localX(){return this._localX}set localX(e){this.setLocalXY(e,this._localY)}get localY(){return this._localY}set localY(e){this.setLocalXY(this._localX,e)}get localXOrigin(){return this._localXOrigin}get localYOrigin(){return this._localYOrigin}resetLocalXY(e,t){return this._localXOrigin=e,this._localYOrigin=t,this._localX=e,this._localY=t,this}setLocalXY(e,t,i){return this._localX===e&&this._localY===t||(this._localX=e,this._localY=t,i||this.updateVertexPosition(e,t)),this}setWorldXY(e,t){if(this._worldX===e&&this._worldY===t)return this;var s,n,o,a,h,l=(s=this.parent,n=e,o=t,a=s.width/2,h=s.height/2,r.x=n-s.x,r.y=o-s.y,r.x/=s.scaleX,r.y/=s.scaleY,i(r,0,0,-s.rotation),r.x+=a,r.y+=h,r);return this.setLocalXY(l.x,l.y),this}setPosition(e,t){return this.setWorldXY(e,t),this}getWorldXY(){return s(this.parent,this._localX,this._localY)}get x(){return s(this.parent,this._localX,this._localY).x}set x(e){this.setWorldXY(e,this.y)}get y(){return s(this.parent,this._localX,this._localY).y}set y(e){this.setWorldXY(this.x,e)}}const o=Phaser.Geom.Mesh.Vertex,a=Phaser.Geom.Mesh.Face,h=[0,2,3,0,3,1],l=[1,3,2,1,2,0],c=[0,3,4,0,4,1,1,4,2,4,5,2,3,6,4,6,7,4,4,7,8,4,8,5],u=Phaser.Utils.Objects.IsPlainObject,d=Phaser.Utils.Objects.GetValue;class g extends t{constructor(e,t,i,s,r,g){u(t)&&(t=d(g=t,"x",0),i=d(g,"y",0),s=d(g,"key",null),r=d(g,"frame",null)),super(e,t,i,s,r),this.type="rexQuadImage",this.isNinePointMode=d(g,"ninePointMode",!1),this.fourPointsModeRTL=d(g,"rtl",!1),this.controlPoints=[],function(e){for(var t,i=e.isNinePointMode,s=i?9:4,r=e.vertices,u=e.faces,d=e.controlPoints,g=0;g<s;g++){var f=new o;r.push(f),d.push(new n(e,f))}g=0;for(var v=(t=i?c:e.fourPointsModeRTL?l:h).length;g<v;g+=3){var x=r[t[g+0]],y=r[t[g+1]],w=r[t[g+2]];u.push(new a(x,y,w))}i?(e.topLeft=d[0],e.topCenter=d[1],e.topRight=d[2],e.centerLeft=d[3],e.center=d[4],e.centerRight=d[5],e.bottomLeft=d[6],e.bottomCenter=d[7],e.bottomRight=d[8]):(e.topLeft=d[0],e.topRight=d[1],e.bottomLeft=d[2],e.bottomRight=d[3])}(this),this.hideCCW=!1,this.syncSize()}destroy(e){if(this.scene&&!this.ignoreDestroy){super.destroy(e);for(var t=0,i=this.controlPoints.length;t<i;t++)this.controlPoints[t].destroy();this.controlPoints=void 0}}resetVerts(){this.dirtyCache[9]=-1;for(var e=function(e){var t,i=e.height,s=e.width;if(e.isNinePointMode){var r=(0+s)/2,n=(0+i)/2;t=[0,0,r,0,s,0,0,n,r,n,s,n,0,i,r,i,s,i]}else t=[0,0,s,0,0,i,s,i];return t}(this),t=this.width,i=this.height,s=this.frame.cutWidth/i/2,r=this.frame.cutHeight/i/2,n=this.frame.u0,o=this.frame.u1,a=this.frame.v0,h=o-n,l=this.frame.v1-a,c=this.controlPoints,u=0,d=e.length;u<d;u+=2){var g=e[u+0],f=e[u+1],v=u/2,x=g/i-s,y=f/i-r,w=n+h*(g/t),m=a+l*(f/i);this.vertices[v].set(x,-y,0).setUVs(w,m),c[v].resetLocalXY(g,f)}return this}syncSize(){return this.setSizeToFrame(),this.setOrtho(this.width/this.height,1),this.resetVerts(),this}}function f(e,t,i,s,r){var n=new g(this.scene,e,t,i,s,r);return this.scene.add.existing(n),n}const v=Phaser.Utils.Objects.GetAdvancedValue,x=Phaser.GameObjects.BuildGameObject;function y(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=v(e,"key",null),s=v(e,"frame",null),r=new g(this.scene,0,0,i,s,e);return x(this.scene,r,e),r}const w=Phaser.Textures.DynamicTexture;var m=function(e,t,i){return void 0===t&&(t=2),void 0===i&&(i=2),new w(e.sys.textures,null,t,i)},p=function(e){return void 0!==e.displayWidth?e.displayWidth:e.width},P=function(e){return void 0!==e.displayHeight?e.displayHeight:e.height};const b=Phaser.Geom.Rectangle,O=Phaser.Math.Vector2,X=Phaser.Math.RotateAround,Y=Phaser.GameObjects.Container;var k=function(e,t){if(void 0===t?t=new b:!0===t&&(void 0===j&&(j=new b),t=j),e.getBounds&&!(e instanceof Y))return e.getBounds(t);var i,s,r,n,o,a,h,l;if(e.parentContainer){var c=e.parentContainer.getBoundsTransformMatrix();G(e,t),c.transformPoint(t.x,t.y,t),i=t.x,s=t.y,_(e,t),c.transformPoint(t.x,t.y,t),r=t.x,n=t.y,R(e,t),c.transformPoint(t.x,t.y,t),o=t.x,a=t.y,T(e,t),c.transformPoint(t.x,t.y,t),h=t.x,l=t.y}else G(e,t),i=t.x,s=t.y,_(e,t),r=t.x,n=t.y,R(e,t),o=t.x,a=t.y,T(e,t),h=t.x,l=t.y;return t.x=Math.min(i,r,o,h),t.y=Math.min(s,n,a,l),t.width=Math.max(i,r,o,h)-t.x,t.height=Math.max(s,n,a,l)-t.y,t},j=void 0,G=function(e,t,i){return void 0===t?t=new O:!0===t&&(void 0===S&&(S=new O),t=S),e.getTopLeft?e.getTopLeft(t,i):(t.x=e.x-p(e)*e.originX,t.y=e.y-P(e)*e.originY,M(e,t,i))},_=function(e,t,i){return void 0===t?t=new O:!0===t&&(void 0===S&&(S=new O),t=S),e.getTopRight?e.getTopRight(t,i):(t.x=e.x-p(e)*e.originX+p(e),t.y=e.y-P(e)*e.originY,M(e,t,i))},R=function(e,t,i){return void 0===t?t=new O:!0===t&&(void 0===S&&(S=new O),t=S),e.getBottomLeft?e.getBottomLeft(t,i):(t.x=e.x-p(e)*e.originX,t.y=e.y-P(e)*e.originY+P(e),M(e,t,i))},T=function(e,t,i){return void 0===t?t=new O:!0===t&&(void 0===S&&(S=new O),t=S),e.getBottomRight?e.getBottomRight(t,i):(t.x=e.x-p(e)*e.originX+p(e),t.y=e.y-P(e)*e.originY+P(e),M(e,t,i))},S=void 0,M=function(e,t,i){return void 0===i&&(i=!1),0!==e.rotation&&X(t,e.x,e.y,e.rotation),i&&e.parentContainer&&e.parentContainer.getBoundsTransformMatrix().transformPoint(t.x,t.y,t),t};const V=Phaser.Geom.Rectangle,C=Phaser.Geom.Rectangle.Union;var L,D=function(e,t){var i=Array.isArray(e);if(void 0===t?t=i?[]:{}:function(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]}(t),i){t.length=e.length;for(var s=0,r=e.length;s<r;s++)t[s]=e[s]}else for(var n in e)t[n]=e[n];return t};const B=Phaser.GameObjects.GameObject,U=Phaser.GameObjects.Layer;var A=Phaser.Utils.Objects.GetValue,W=function(e){if(e){var t,i,s=e.gameObjects,r=e.renderTexture,n=e.saveTexture,o=A(e,"x",void 0),a=A(e,"y",void 0),h=A(e,"width",void 0),l=A(e,"height",void 0),c=A(e,"originX",0),u=A(e,"originY",0),d=A(e,"padding",0);if(void 0===h||void 0===l||void 0===o||void 0===a){var g=function(e,t){var i;void 0===t?t=new V:!0===t&&(void 0===L&&(L=new V),t=L),t.setTo(0,0,0,0);for(var s=!0,r=0,n=e.length;r<n;r++)if((i=e[r]).getBounds){var o=k(i,!0);s?(t.setTo(o.x,o.y,o.width,o.height),s=!1):C(o,t,t)}return t}(s,!0);void 0!==o&&void 0!==a?(h=2*Math.max(o-g.left,g.right-o),l=2*Math.max(a-g.top,g.bottom-a),c=.5,u=.5):(o=g.x,a=g.y,h=g.width,l=g.height,c=0,u=0),t=g.x,i=g.y}else t=o+(0-c)*h,i=a+(0-u)*l;t-=d,i-=d,h+=2*d,l+=2*d;var f,v=s[0].scene,x=v.sys.textures;return n&&!r&&(r=x.addDynamicTexture(n,h,l)),r||(r=v.add.renderTexture(0,0,h,l)),r.setPosition&&r.setPosition(o,a),r.width===h&&r.height===l||r.setSize(h,l),r.setOrigin&&r.setOrigin(c,u),r.camera.setScroll(t,i),s=function(e,t){if(e.length<=1)return e;var i;void 0===t&&(t=!1);for(var s=0,r=e.length;s<r;s++){var n=e[s];if(n.displayList?i=n.displayList:n.parentContainer&&(i=n.parentContainer.list),i)break}return i||(i=n.scene.sys.displayList),i.depthSort&&(i.depthSort(),i=i.list),t?e.sort((function(e,t){return i.indexOf(t)-i.indexOf(e)})):e.sort((function(e,t){return i.indexOf(e)-i.indexOf(t)})),e}(D(s)),r.draw(s),n&&((f=r)instanceof B||f instanceof U?r.saveTexture(n):r.key!==n&&x.renameTexture(r.key,key)),r}};const I=Phaser.Utils.Objects.IsPlainObject,z=Phaser.Utils.Objects.GetValue;class H extends g{constructor(e,t,i,s,r,n){I(t)&&(t=z(n=t,"x",0),i=z(n,"y",0),s=z(n,"width",32),r=z(n,"height",32)),super(e,t,i,m(e,s,r),null,n),this.type="rexQuadRenderTexture",this.rt=this.texture}destroy(e){this.scene&&!this.ignoreDestroy&&(super.destroy(e),this.rt.destroy(),this.rt=null)}snapshot(e,t){return void 0===t&&(t={}),t.gameObjects=e,t.renderTexture=this.rt,W(t),this.width===this.frame.realWidth&&this.height===this.frame.realHeight||this.syncSize(),this}}function Q(e,t,i,s,r){var n=new H(this.scene,e,t,i,s,r);return this.scene.add.existing(n),n}const N=Phaser.Utils.Objects.GetAdvancedValue,F=Phaser.GameObjects.BuildGameObject;function q(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=N(e,"width",32),s=N(e,"height",32),r=new H(this.scene,0,0,i,s,e);return F(this.scene,r,e),r}var E=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0);for(var s=.5*e.width,r=.5*e.height,n=Math.tan(t)*r,o=Math.tan(i)*s,a=e.controlPoints,h=0,l=a.length;h<l;h++){var c=a[h],u=c.localXOrigin,d=c.localYOrigin;c.localX=u+(d>r?n:-n),c.localY=d+(u>s?o:-o)}};const J=Phaser.Utils.Objects.IsPlainObject,K=Phaser.Utils.Objects.GetValue,Z=Phaser.Math.DegToRad,$=Phaser.Math.RadToDeg;class ee extends g{constructor(e,t,i,s,r){if(J(t)){var n=t;t=K(n,"x",0),i=K(n,"y",0),s=K(n,"key",null),r=K(n,"frame",null)}super(e,t,i,s,r),this.type="rexSkewmage",this._skewX=0,this._skewY=0}get skewX(){return this._skewX}set skewX(e){this._skewX=e,E(this,this._skewX,this._skewY)}get skewXDeg(){return $(this._skewX)}set skewXDeg(e){this.skewX=Z(e)}get skewY(){return this._skewY}set skewY(e){this._skewY=e,E(this,this._skewX,this._skewY)}get skewYDeg(){return $(this._skewY)}set skewYDeg(e){this.skewY=Z(e)}setSkewX(e){return this.skewX=e,this}setSkewY(e){return this.skewY=e,this}setSkew(e,t){return void 0===t&&(t=e),this.skewX=e,this.skewY=t,this}setSkewXDeg(e){return this.skewXDeg=e,this}setSkewYDeg(e){return this.skewYDeg=e,this}setSkewDeg(e,t){return void 0===t&&(t=e),this.skewXDeg=e,this.skewYDeg=t,this}}function te(e,t,i,s){var r=new ee(this.scene,e,t,i,s);return this.scene.add.existing(r),r}const ie=Phaser.Utils.Objects.GetAdvancedValue,se=Phaser.GameObjects.BuildGameObject;function re(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=ie(e,"key",null),s=ie(e,"frame",null),r=new ee(this.scene,0,0,i,s);return se(this.scene,r,e),r}const ne=Phaser.Utils.Objects.IsPlainObject,oe=Phaser.Utils.Objects.GetValue;class ae extends ee{constructor(e,t,i,s,r){if(ne(t)){var n=t;t=oe(n,"x",0),i=oe(n,"y",0),s=oe(n,"width",32),r=oe(n,"height",32)}super(e,t,i,m(e,s,r),null),this.type="rexSkewRenderTexture",this.rt=this.texture}destroy(e){this.scene&&!this.ignoreDestroy&&(super.destroy(e),this.rt.destroy(),this.rt=null)}}function he(e,t,i,s){var r=new ae(this.scene,e,t,i,s);return this.scene.add.existing(r),r}const le=Phaser.Utils.Objects.GetAdvancedValue,ce=Phaser.GameObjects.BuildGameObject;function ue(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=le(e,"width",32),s=le(e,"height",32),r=new ae(this.scene,0,0,i,s);return ce(this.scene,r,e),r}const de=Phaser.Utils.Objects.GetValue;var ge=function(e,t){if(!e)return!1;for(var i=t.visibleSibling,s=0,r=i.length;s<r;s++)e.setChildVisible(i[s],!0);return i.length=0,e.setChildVisible(t,!1),t.isRunning=!1,!0},fe=function(e){return class extends e{constructor(e,t){var i=e.scene;super(i,0,0,1,1,t),i.add.existing(this),function(e,t,i){t.visibleSibling=[],t.isRunning=!1,t.useParentBounds=de(i,"useParentBounds",!1),t.setPosition(e.x,e.y).setVisible(!1),e.pin(t)}(e,this,t)}destroy(e){this.scene&&!this.ignoreDestroy&&(this.exit(),super.destroy(e))}enter(){return function(e,t){if(!e)return!1;ge(e,t);var i=t.useParentBounds;W({gameObjects:e.getAllVisibleChildren(),renderTexture:t.rt,x:t.x,y:t.y,width:i?e.displayWidth:void 0,height:i?e.displayHeighth:void 0,originX:i?e.originX:void 0,originY:i?e.originY:void 0}),e.setChildVisible(t,!0);for(var s=t.visibleSibling,r=e.children,n=0,o=r.length;n<o;n++){var a=r[n];a.visible&&a!==t&&(e.setChildVisible(a,!1),s.push(a))}return t.isRunning=!0,!0}(this.rexContainer.parent,this)&&this.syncSize(),this}exit(){return ge(this.rexContainer.parent,this),this}}};class ve extends(fe(ae)){get skewState(){return this.isRunning}}var xe=function(e){return null!==e&&"object"==typeof e},ye=function(e,t,i,s="."){if(!xe(e))return e;if(function(e){return null==e}(t)||""===t||Array.isArray(t)&&0===t.length)return e;if("string"==typeof t&&-1===t.indexOf(s))return e[t]=i,e;var r=function(e,t){return Array.isArray(e)||(e="string"!=typeof e||""===e.trim()?[]:e.split(t).filter(Boolean)),e}(t,s);if(0===r.length)return e;for(var n=e,o=r.length,a=0;a<o-1;a++){var h=r[a],l=n[h];xe(l)||(n[h]={}),n=n[h]}return n[r[o-1]]=i,e};class we extends Phaser.Plugins.BasePlugin{constructor(e){super(e),e.registerGameObject("rexQuadImage",f,y),e.registerGameObject("rexQuadRenderTexture",Q,q),e.registerGameObject("rexSkewImage",te,re),e.registerGameObject("rexSkewRenderTexture",he,ue)}start(){this.game.events.on("destroy",this.destroy,this)}addContainerSkew(e,t){return new ve(e,t)}}return ye(window,"RexPlugins.GameObjects.QuadImage",g),ye(window,"RexPlugins.GameObjects.QuadRenderTexture",H),ye(window,"RexPlugins.GameObjects.SkewImage",ee),ye(window,"RexPlugins.GameObjects.SkewRenderTexture",ae),ye(window,"RexPlugins.GameObjects.ContainerSkew",ve),we},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexquadimageplugin=t();
