!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rextagtextplugin=e();}(undefined,(function(){function t(t,n,i){return n=h(n),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}(t,e()?Reflect.construct(n,i||[],h(t).constructor):n.apply(t,i))}function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));}catch(t){}return (e=function(){return !!t})()}function n(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===e?String:Number)(t)}(t,"string");return "symbol"==typeof e?e:String(e)}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,n(r.key),r);}}function a(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e);}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},c.apply(this,arguments)}function f(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}
/**
   * @author       Richard Davey <rich@photonstorm.com>
   * @copyright    2019 Photon Storm Ltd.
   * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
   */()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var p,g=Phaser.Renderer.WebGL.Utils,y={renderWebGL:function(t,e,n,i){if(0!==e.width&&0!==e.height){n.addToRenderList(e);var r=e.frame,s=r.width,a=r.height,o=g.getTintAppendFloatAlpha,h=t.pipelines.set(e.pipeline,e),l=h.setTexture2D(r.glTexture,e);t.pipelines.preBatch(e),h.batchTexture(e,r.glTexture,s,a,e.x,e.y,s/e.style.resolution,a/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,s,a,o(e.tintTopLeft,n.alpha*e._alphaTL),o(e.tintTopRight,n.alpha*e._alphaTR),o(e.tintBottomLeft,n.alpha*e._alphaBL),o(e.tintBottomRight,n.alpha*e._alphaBR),e.tintFill,0,0,n,i,!1,l),t.pipelines.postBatch(e);}},renderCanvas:function(t,e,n,i){0!==e.width&&0!==e.height&&(n.addToRenderList(e),t.batchSprite(e,e.frame,n,i));}},v=Phaser.Display.Canvas.CanvasPool,k=!1;k||(void 0===p&&(p=60),parseInt(Phaser.VERSION.match(/\.(\d+)\./)[1])<p&&console.error("Minimum supported version : 3.".concat(p)),k=!0);var w=function(e){function n(){return r(this,n),t(this,n,arguments)}return o(n,e),a(n,[{key:"setStyle",value:function(t){return this.style.setStyle(t)}},{key:"setFont",value:function(t){return this.style.setFont(t)}},{key:"setFontFamily",value:function(t){return this.style.setFontFamily(t)}},{key:"setFontSize",value:function(t){return this.style.setFontSize(t)}},{key:"setFontStyle",value:function(t){return this.style.setFontStyle(t)}},{key:"setTestString",value:function(t){return this.style.setTestString(t)}},{key:"setFixedSize",value:function(t,e){return this.style.setFixedSize(t,e)}},{key:"setBackgroundColor",value:function(t,e,n){return this.style.setBackgroundColor(t,e,n)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.style.setBackgroundStrokeColor(t,e)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.style.setBackgroundCornerRadius(t,e)}},{key:"setFill",value:function(t){return this.style.setFill(t)}},{key:"setColor",value:function(t){return this.style.setColor(t)}},{key:"setStroke",value:function(t,e){return this.style.setStroke(t,e)}},{key:"setShadow",value:function(t,e,n,i,r,s){return this.style.setShadow(t,e,n,i,r,s)}},{key:"setShadowOffset",value:function(t,e){return this.style.setShadowOffset(t,e)}},{key:"setShadowColor",value:function(t){return this.style.setShadowColor(t)}},{key:"setShadowBlur",value:function(t){return this.style.setShadowBlur(t)}},{key:"setShadowStroke",value:function(t){return this.style.setShadowStroke(t)}},{key:"setShadowFill",value:function(t){return this.style.setShadowFill(t)}},{key:"setWrapMode",value:function(t){return this.style.setWrapMode(t)}},{key:"setWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setWordWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setHAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setVAlign",value:function(t){return this.style.setVAlign(t)}},{key:"setLineSpacing",value:function(t){return this.lineSpacing=t,this.updateText(!1),this}},{key:"setXOffset",value:function(t){return this.style.setXOffset(t)}},{key:"setMaxLines",value:function(t){return this.style.setMaxLines(t)}},{key:"setResolution",value:function(t){return this.style.setResolution(t)}},{key:"getTextMetrics",value:function(){return this.style.getTextMetrics()}},{key:"setTextMetrics",value:function(t,e){return this.style.setTextMetrics(t,e)}},{key:"measureTextMargins",value:function(t,e){return function(t,e,n){void 0===n&&(n={});var i=v.create(this),r=i.getContext("2d",{willReadFrequently:!0});t.syncFont(i,r);var s=r.measureText(e),a=Math.ceil(s.width*t.baselineX),o=a,h=2*o;if(o=o*t.baselineY|0,i.width=a,i.height=h,r.fillStyle="#f00",r.fillRect(0,0,a,h),r.font=t._font,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(t.testString,0,o),n.left=0,0===a||0===h||!r.getImageData(0,0,a,h))return v.remove(i),n;for(var l=r.getImageData(0,0,a,h).data,u=!1,c=0;c<a;c++){for(var f=0;f<h;f++)if(255!==l[4*(f*a+c)]){n.left=c,u=!0;break}if(u)break}return v.remove(i),n}(this.style,t,e)}}]),n}(Phaser.GameObjects.GameObject),x=Phaser.GameObjects.Components;Phaser.Class.mixin(w,[x.Alpha,x.BlendMode,x.ComputedSize,x.Crop,x.Depth,x.Flip,x.GetBounds,x.Mask,x.Origin,x.Pipeline,x.PostPipeline,x.ScrollFactor,x.Tint,x.Transform,x.Visible,y]);var m=Phaser.Utils.String.Pad,T=function(t,e,n){if(null==t)return t;switch(i(t)){case"string":default:return t;case"number":return "#".concat(m(Math.floor(t).toString(16),6,"0",1));case"function":return t(e,n);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?"rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"):"rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")"):t.hasOwnProperty("h")?t.hasOwnProperty("a")?"hsla(".concat(t.h,",").concat(t.s,",").concat(t.l,",").concat(t.a,")"):"hsl(".concat(t.h,",").concat(t.s,",").concat(t.l,")"):t}},S={backgroundColor:["backgroundColor",null,T],backgroundColor2:["backgroundColor2",null,T],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,T],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",T],stroke:["stroke","#fff",T],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",T],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",T],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],strikethroughColor:["strikethrough.color","#000",T],strikethroughThickness:["strikethrough.thickness",0,null],strikethroughOffset:["strikethrough.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]},b=Phaser.Display.Canvas.CanvasPool,P=function(t){var e=b.create(this),n=e.getContext("2d",{willReadFrequently:!0});t.syncFont(e,n);var i=n.measureText(t.testString);if("actualBoundingBoxAscent"in i){var r=i.actualBoundingBoxAscent,s=i.actualBoundingBoxDescent,a={ascent:r,descent:s,fontSize:r+s};return b.remove(e),a}var o=Math.ceil(i.width*t.baselineX),h=o,l=2*h;h=h*t.baselineY|0,e.width=o,e.height=l,n.fillStyle="#f00",n.fillRect(0,0,o,l),n.font=t._font,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(t.testString,0,h);a={ascent:0,descent:0,fontSize:0};if(!n.getImageData(0,0,o,l))return a.ascent=h,a.descent=h+6,a.fontSize=a.ascent+a.descent,b.remove(e),a;var u,c,f=n.getImageData(0,0,o,l).data,d=f.length,p=4*o,g=0,y=!1;for(u=0;u<h;u++){for(c=0;c<p;c+=4)if(255!==f[g+c]){y=!0;break}if(y)break;g+=p;}for(a.ascent=h-u,g=d-p,y=!1,u=l;u>h;u--){for(c=0;c<p;c+=4)if(255!==f[g+c]){y=!0;break}if(y)break;g-=p;}return a.descent=u-h,a.fontSize=a.ascent+a.descent,b.remove(e),a},O=0,M=1,C=2,F=0,L=1,A=2,W=3,R=/(?:\r\n|\r|\n)/,_=Phaser.Utils.Objects.GetAdvancedValue,z=Phaser.Utils.Objects.GetValue,B=function(){function t(e,n,i){r(this,t),this.parent=e,void 0===i&&(i=S),this.propertyMap=i,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.strikethroughColor,this.strikethroughThickness,this.strikethroughOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(n,!1,!0);}return a(t,[{key:"isWrapFitMode",get:function(){return this.fixedWidth>0&&this.wrapMode!==F&&0===this.wrapWidth}},{key:"setStyle",value:function(t,e,n){if(void 0===e&&(e=!0),void 0===n&&(n=!1),t&&t.hasOwnProperty("wordWrap")){var i=t.wordWrap;i.hasOwnProperty("width")&&(t.wrap={mode:"word",width:i.width});}if(t&&t.hasOwnProperty("wrap")){var r=t.wrap;if(r.hasOwnProperty("mode")){var s=r.mode;"string"==typeof s&&(r.mode=I[s]);}else r.hasOwnProperty("width")&&(r.mode=1);}t&&t.rtl&&n&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px");var a=this.propertyMap;for(var o in a){var h=a[o],l=h[0],u=n?h[1]:this[o],c=h[2];if("wrapCallback"===o||"wrapCallbackScope"===o)this[o]=z(t,l,u);else {var f=_(t,l,u);c&&(f=c(f)),this[o]=f;}}var d=z(t,"font",null);this._font=null===d?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:d;var p=z(t,"fill",null);null!==p&&(this.color=T(p));var g=z(t,"metrics",!1);return g?this.metrics={ascent:z(g,"ascent",0),descent:z(g,"descent",0),fontSize:z(g,"fontSize",0)}:!e&&this.metrics||(this.metrics=P(this)),e?this.parent.updateText():this.parent}},{key:"syncFont",value:function(t,e){e.font=this._font;}},{key:"syncStyle",value:function(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round";}},{key:"syncShadow",value:function(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0);}},{key:"update",value:function(t){return t&&(this._font="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim(),this.metrics=P(this)),this.parent.updateText(t)}},{key:"buildFont",value:function(){var t="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim();return t!==this._font&&(this._font=t),this}},{key:"setFont",value:function(t){return "string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=z(t,"fontFamily","Courier"),this.fontSize=z(t,"fontSize","16px"),this.fontStyle=z(t,"fontStyle","")),this.update(!0)}},{key:"setFontFamily",value:function(t){return this.fontFamily=t,this.update(!0)}},{key:"setFontStyle",value:function(t){return this.fontStyle=t,this.update(!0)}},{key:"setFontSize",value:function(t){return "number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}},{key:"setTestString",value:function(t){return this.testString=t,this.update(!0)}},{key:"setFixedSize",value:function(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}},{key:"setResolution",value:function(t){return this.resolution=t,this.update(!1)}},{key:"setXOffset",value:function(t){return this.xOffset=t,this.update(!1)}},{key:"setBackgroundColor",value:function(t,e,n){return void 0===n&&(n=!0),this.backgroundColor=T(t,this.parent.canvas,this.parent.context),this.backgroundColor2=T(e,this.parent.canvas,this.parent.context),this.backgroundHorizontalGradient=n,this.update(!1)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.backgroundStrokeColor=T(t,this.parent.canvas,this.parent.context),this.backgroundStrokeLineWidth=e,this.update(!1)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}},{key:"setFill",value:function(t){return this.color=T(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setColor",value:function(t){return this.color=T(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setStroke",value:function(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=T(t,this.parent.canvas,this.parent.context),this.strokeThickness=e),this.update(!0)}},{key:"setShadow",value:function(t,e,n,i,r,s){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n="#000"),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===s&&(s=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=T(n,this.parent.canvas,this.parent.context),this.shadowBlur=i,this.shadowStroke=r,this.shadowFill=s,this.update(!1)}},{key:"setShadowOffset",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}},{key:"setShadowColor",value:function(t){return void 0===t&&(t="#000"),this.shadowColor=T(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setShadowBlur",value:function(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}},{key:"setShadowStroke",value:function(t){return this.shadowStroke=t,this.update(!1)}},{key:"setShadowFill",value:function(t){return this.shadowFill=t,this.update(!1)}},{key:"setUnderline",value:function(t,e,n){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===n&&(n=0),this.underlineColor=T(t,this.parent.canvas,this.parent.context),this.underlineThickness=e,this.underlineOffset=n,this.update(!1)}},{key:"setUnderlineColor",value:function(t){return void 0===t&&(t="#000"),this.underlineColor=T(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setUnderlineThickness",value:function(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}},{key:"setUnderlineOffset",value:function(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}},{key:"setStrikethrough",value:function(t,e,n){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===n&&(n=0),this.strikethroughColor=T(t,this.parent.canvas,this.parent.context),this.strikethroughThickness=e,this.strikethroughOffset=n,this.update(!1)}},{key:"setStrikethroughColor",value:function(t){return void 0===t&&(t="#000"),this.strikethroughColor=T(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setStrikethroughThickness",value:function(t){return void 0===t&&(t=0),this.strikethroughThickness=t,this.update(!1)}},{key:"setStrikethroughOffset",value:function(t){return void 0===t&&(t=0),this.strikethroughOffset=t,this.update(!1)}},{key:"setWrapMode",value:function(t){return "string"==typeof t&&(t=I[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}},{key:"setWrapWidth",value:function(t){return this.wrapWidth=t,this.update(!1)}},{key:"setAlign",value:function(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}},{key:"setHAlign",value:function(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}},{key:"setVAlign",value:function(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}},{key:"setMaxLines",value:function(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}},{key:"getTextMetrics",value:function(){var t=this.metrics;return {ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}},{key:"setTextMetrics",value:function(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,e&&("string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=z(e,"fontFamily",this.fontFamily),this.fontSize=z(e,"fontSize",this.fontSize),this.fontStyle=z(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}},{key:"lineHeight",get:function(){return this.metrics.fontSize+this.strokeThickness+this.parent.lineSpacing}},{key:"toJSON",value:function(){var t={},e=this.propertyMap;for(var n in e)t[n]=this[n];return t.metrics=this.getTextMetrics(),t}},{key:"destroy",value:function(){this.parent=void 0;}}]),t}(),I={none:F,word:L,char:A,character:A,mix:W},j=Phaser.Utils.Objects.GetValue,H=function(){function t(e,n,i,s,a){r(this,t),void 0===e&&(e=0),void 0===n&&(n=e),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),this.cornerRadius={},this._width=0,this._height=0,this.setTo(e,n,i,s,a);}return a(t,[{key:"setTo",value:function(t,e,n,i,r){return this.setPosition(t,e),this.setRadius(r),this.setSize(n,i),this}},{key:"setPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setRadius",value:function(t){return void 0===t&&(t=0),this.radius=t,this}},{key:"setSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"minWidth",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}},{key:"minHeight",get:function(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}},{key:"width",get:function(){return this._width},set:function(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth);}},{key:"height",get:function(){return this._height},set:function(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight);}},{key:"radius",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)},set:function(t){var e,n;"number"==typeof t?(e=t,n=t):(e=j(t,"x",0),n=j(t,"y",0));var i=this.cornerRadius;i.tl=X(j(t,"tl",void 0),e,n),i.tr=X(j(t,"tr",void 0),e,n),i.bl=X(j(t,"bl",void 0),e,n),i.br=X(j(t,"br",void 0),e,n);}},{key:"radiusTL",get:function(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)},set:function(t){G(this.cornerRadius.tl,t);}},{key:"radiusTR",get:function(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)},set:function(t){G(this.cornerRadius.tr,t);}},{key:"radiusBL",get:function(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)},set:function(t){G(this.cornerRadius.bl,t);}},{key:"radiusBR",get:function(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)},set:function(t){G(this.cornerRadius.br,t);}}]),t}(),X=function(t,e,n){return void 0===t?t={x:e,y:n}:"number"==typeof t&&(t={x:t,y:t}),Y(t),t},G=function(t,e){"number"==typeof e?(t.x=e,t.y=e):(t.x=j(e,"x",0),t.y=j(e,"y",0)),Y(t);},Y=function(t){t.convex=t.x>=0||t.y>=0,t.x=Math.abs(t.x),t.y=Math.abs(t.y);},D=Phaser.Math.DegToRad,U=function(t){return !t.hasOwnProperty("convex")||t.convex},K=function(t){return t.x>0&&t.y>0},V=function(t,e,n,i,r,s,a,o,h){if(o&&a>s?a-=360:!o&&a<s&&(a+=360),s=D(s),a=D(a),null==h)t.ellipse(e,n,i,r,0,s,a,o);else for(var l,u,c,f=(a-s)/(h+=1),d=0;d<=h;d++)c=s+f*d,l=e+i*Math.cos(c),u=n+r*Math.sin(c),t.lineTo(l,u);},E=function(t,e,n,i,r,s,a,o,h,l,u,c,f){if(function(t,e,n,i,r,s,a){var o,h,l,u,c,f=new H(e,n,i,r,s),d=f.minWidth,p=f.minHeight,g=i>=d?1:i/d,y=r>=p?1:r/p,v=f.cornerRadius;t.save(),t.beginPath(),t.translate(e,n),o=v.tl,K(o)?(h=o.x*g,l=o.y*y,U(o)?V(t,h,l,h,l,180,270,!1,a):V(t,0,0,h,l,90,0,!0,a),u=0,c=l):(t.lineTo(0,0),u=0,c=0),o=v.tr,K(o)?(h=o.x*g,l=o.y*y,U(o)?V(t,i-h,l,h,l,270,360,!1,a):V(t,i,0,h,l,180,90,!0,a)):t.lineTo(i,0),o=v.br,K(o)?(h=o.x*g,l=o.y*y,U(o)?V(t,i-h,r-l,h,l,0,90,!1,a):V(t,i,r,h,l,270,180,!0,a)):t.lineTo(i,r),o=v.bl,K(o)?(h=o.x*g,l=o.y*y,U(o)?V(t,h,r-l,h,l,90,180,!1,a):V(t,0,r,h,l,360,270,!0,a)):t.lineTo(0,r),t.lineTo(u,c),t.closePath(),t.restore();}(e,n,i,r,s,a,f),null!=o){var d;if(null!=u)(d=c?e.createLinearGradient(0,0,r,0):e.createLinearGradient(0,0,0,s)).addColorStop(0,o),d.addColorStop(1,u),o=d;e.fillStyle=o,e.fill();}null!=h&&l>0&&(e.strokeStyle=h,e.lineWidth=l,e.stroke());},N={draw:function(t,e,n,i){var r=this.penManager;this.hitAreaManager.clear();var s=this.context;s.save();var a=this.defaultStyle;this.clear(),function(t,e,n,i,r,s,a,o){if(null!=e||null!=n){var h=t.canvas.width,l=t.canvas.height;null==n&&(i=0);var u=i/2;h=Math.max(1,h-i),l=Math.max(1,l-i),E(t.canvas,t.context,u,u,h,l,r,e,n,i,s,a,o);}}(this,a.backgroundColor,a.backgroundStrokeColor,a.backgroundStrokeLineWidth,a.backgroundCornerRadius,a.backgroundColor2,a.backgroundHorizontalGradient,a.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset;var o,h,l,u,c,f,d=a.halign,p=a.valign,g=a.lineHeight,y=r.lines,v=y.length,k=a.maxLines;k>0&&v>k?(h=k,l="center"===p?Math.floor((v-h)/2):"bottom"===p?v-h:0):(h=v,l=0),u=l+h;var w=this.rtl,x=w?this.parent.width:void 0;f="center"===p?Math.max((i-h*g)/2,0):"bottom"===p?Math.max(i-h*g-2,0):0,f+=e;for(var m=l;m<u;m++)if(0!==(o=r.getLineWidth(m))){for(var T=y[m],S=T.length,b=d,P=0;P<S;P++){var O=T[P].prop.align;if(void 0!==O){b=O;break}}c="center"===b?(n-o)/2:"right"===b?w?0:n-o:w?n-o:0,c+=t;for(P=0;P<S;P++)this.drawPen(T[P],c,f,x);}s.restore();},drawPen:function(t,e,n,i){e+=t.x,n+=t.y+(t.prop.y||0),void 0!==i&&(e=i-e);var r=this.canvas,s=this.context;s.save();var a=this.parser.propToContextStyle(this.defaultStyle,t.prop);if(a.buildFont(),a.syncFont(r,s),a.syncStyle(r,s),a.underlineThickness>0&&t.width>0){var o=n+a.underlineOffset-a.underlineThickness/2;this.drawLine(e,o,t.width,a.underlineThickness,a.underlineColor,a);}if(t.isTextPen&&this.drawText(e,n,t.text,a),t.isImagePen&&this.drawImage(e,n,t.prop.img,t.prop.color,a),a.strikethroughThickness>0&&t.width>0){o=n+a.strikethroughOffset-a.strikethroughThickness/2;this.drawLine(e,o,t.width,a.strikethroughThickness,a.strikethroughColor,a);}if(s.restore(),t.hasAreaMarker&&t.width>0){var h,l=t.prop.area;if(l)h={key:l};else {var u=t.prop.url;h={key:"url:".concat(u),url:u};}this.hitAreaManager.add(e,n-this.startYOffset,t.width,this.defaultStyle.lineHeight,h);}},clear:function(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height);},drawLine:function(t,e,n,i,r,s){this.autoRound&&(t=Math.round(t),e=Math.round(e));var a=this.context;s.syncShadow(a,s.shadowStroke);var o=a.lineCap;a.lineCap="butt",a.strokeStyle=r,a.lineWidth=i,a.beginPath(),a.moveTo(t,e),a.lineTo(t+n,e),a.stroke(),a.lineCap=o;},drawText:function(t,e,n,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context;i.stroke&&"none"!==i.stroke&&i.strokeThickness>0&&(i.syncShadow(r,i.shadowStroke),r.strokeText(n,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(r,i.shadowFill),r.fillText(n,t,e));},drawImage:function(t,e,n,i,r){e-=this.startYOffset,this.parent.imageManager.draw(n,this.context,t,e,i,this.autoRound);}},J=Phaser.Utils.Objects.GetValue,q=O,$=M,Q=function(){function t(e){r(this,t),this.prop={},this.resetFromJSON(e);}return a(t,[{key:"resetFromJSON",value:function(t){this.text=J(t,"text",""),this.x=J(t,"x",0),this.y=J(t,"y",0),this.width=J(t,"width",0);var e=J(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=J(t,"newLineMode",0),this.startIndex=J(t,"startIndex",0);}},{key:"plainText",get:function(){var t=this.text;return this.newLineMode===$&&(t+="\n"),t}},{key:"wrapText",get:function(){var t=this.text;return this.newLineMode!==q&&(t+="\n"),t}},{key:"rawTextLength",get:function(){var t=this.text.length;return this.newLineMode===$&&(t+=1),t}},{key:"endIndex",get:function(){return this.startIndex+this.rawTextLength}},{key:"lastX",get:function(){return this.x+this.width}},{key:"isTextPen",get:function(){return ""!==this.text}},{key:"isImagePen",get:function(){return !!this.prop.img}},{key:"hasAreaMarker",get:function(){return !!this.prop.area||!!this.prop.url}}]),t}(),Z=function(t){if("object"!==i(t)||null===t)return t;if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e];return t},tt=function(t,e){var n=Array.isArray(t);if(void 0===e?e=n?[]:{}:Z(e),n){e.length=t.length;for(var i=0,r=t.length;i<r;i++)e[i]=t[i];}else for(var s in t)e[s]=t[s];return e},et=function(){},nt=Phaser.Utils.Objects.GetFastValue,it=O,rt=C,st=function(){function t(e){r(this,t),this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.pensPool=e.pensPool,this.linesPool=e.linesPool,this.tagToText=nt(e,"tagToText",et),this.tagToTextScope=nt(e,"tagToTextScope",void 0);}return a(t,[{key:"destroy",value:function(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0;}},{key:"clear",value:function(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.pensPool.pushMultiple(this.pens),this.linesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0;}},{key:"addTextPen",value:function(t,e,n,i,r,s){var a=this.pensPool.pop();return null==a&&(a=new Q),at.text=t,at.x=e,at.y=n,at.width=i,at.prop=r,at.newLineMode=s,a.resetFromJSON(at),this.addPen(a),this}},{key:"addImagePen",value:function(t,e,n,i){return this.addTextPen("",t,e,n,i,it),this}},{key:"addNewLinePen",value:function(){var t=this.lastPen,e=t?t.lastX:0,n=t?t.y:0,i=t?tt(t.prop):null;return this.addTextPen("",e,n,0,i,rt),this}},{key:"addPen",value:function(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var n=this.lastLine;null==n&&(n=this.linesPool.pop()||[],this.lines.push(n)),n.push(t),t.newLineMode!==it&&(n=this.linesPool.pop()||[],this.lines.push(n)),this.maxLinesWidth=void 0;}},{key:"clone",value:function(e){null==e&&(e=new t),e.clear();for(var n=0,i=this.lines.length;n<i;n++)for(var r=this.lines[n],s=0,a=r.length;s<a;s++){var o=r[s];e.addPen(o.text,o.x,o.y,o.width,tt(o.prop),o.newLineMode);}return e}},{key:"lastPen",get:function(){return this.pens[this.pens.length-1]}},{key:"lastLine",get:function(){return this.lines[this.lines.length-1]}},{key:"getLineStartIndex",value:function(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}},{key:"getLineEndIndex",value:function(t){t>=this.lines.length&&(t=this.lines.length-1);var e,n,i=!1;for(e=t;e>=0&&!(i=null!=(n=this.lines[e])&&n.length>0);e--);return i?n[n.length-1].endIndex:0}},{key:"getLineWidth",value:function(t){var e=this.lines[t];if(!e)return 0;var n=e[e.length-1];return null==n?0:n.lastX}},{key:"getMaxLineWidth",value:function(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,n=0,i=this.lines.length;n<i;n++)(t=this.getLineWidth(n))>e&&(e=t);return this.maxLinesWidth=e,e}},{key:"getLineWidths",value:function(){for(var t=[],e=0,n=this.lines.length;e<n;e++)t.push(this.getLineWidth(e));return t}},{key:"linesCount",get:function(){return this.lines.length}},{key:"plainText",get:function(){for(var t="",e=this.pens,n=0,i=e.length;n<i;n++)t+=e[n].plainText;return t}},{key:"rawTextLength",get:function(){for(var t=0,e=this.pens,n=0,i=this.pens.length;n<i;n++)t+=e[n].rawTextLength;return t}},{key:"getSliceTagText",value:function(t,e,n){var i=this.lastPen;if(null==i)return "";var r=i.endIndex;void 0!==t&&0!==t||(t=-1),void 0!==e&&e!==r||(e=r+1),void 0===n&&(n=!1);for(var s,a,o,h,l,u,c="",f=0,d=this.pens.length;f<d&&((h=(s=this.pens[f]).endIndex)<=t||(s=this.pens[f],a=n?s.wrapText:s.plainText,l=s.prop,(o=s.startIndex)>=t&&h<=e||(a=a.substring(t-o,e-o)),this.tagToTextScope?c+=this.tagToText.call(this.tagToTextScope,a,l,u):c+=this.tagToText(a,l,u),u=l,!(h>=e)));f++);return c}},{key:"length",get:function(){return this.lines.length},set:function(t){this.clear();}}]),t}(),at={},ot=function(){function t(){r(this,t),this.items=[];}return a(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0;}},{key:"pop",value:function(){return this.items.length>0?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}(),ht=Phaser.Geom.Rectangle,lt=new ot,ut=function(){function t(){r(this,t),this.hitAreas=[];}return a(t,[{key:"destroy",value:function(){this.clear();}},{key:"clear",value:function(){for(var t=0,e=this.hitAreas.length;t<e;t++)Z(this.hitAreas[t].data);return lt.pushMultiple(this.hitAreas),this}},{key:"add",value:function(t,e,n,i,r){var s=lt.pop();return null===s?s=new ht(t,e,n,i):s.setTo(t,e,n,i),s.data=r,this.hitAreas.push(s),this}},{key:"getFirst",value:function(t,e){for(var n=0,i=this.hitAreas.length;n<i;n++){var r=this.hitAreas[n];if(r.contains(t,e))return r}return null}},{key:"getByKey",value:function(t){for(var e=0,n=this.hitAreas.length;e<n;e++){var i=this.hitAreas[e];if(i.data.key===t)return i}return null}},{key:"drawBounds",value:function(t,e,n){void 0===e&&(e=16777215),n&&t.save().scaleCanvas(n.scaleX,n.scaleY).rotateCanvas(n.rotation).translateCanvas(n.x,n.y);for(var i=0,r=this.hitAreas.length;i<r;i++){var s=this.hitAreas[i];t.lineStyle(1,e).strokeRect(s.x,s.y,s.width,s.height);}return n&&t.restore(),this}}]),t}(),ct=function(t,e,n,i){var r=this.hitAreaManager.getFirst(e,n);if(null!==r){var s=r.data.key;pt.call(this,"areadown",s,t,e,n,i),r.data.isDown=!0;}},ft=function(t,e,n,i){var r=this.hitAreaManager.getFirst(e,n);if(null!==r){var s=r.data,a=s.key;if(pt.call(this,"areaup",a,t,e,n,i),s.isDown){pt.call(this,"areaclick",a,t,e,n,i);var o=s.url;o&&window.open(o,"_blank");}s.isDown=!1;}},dt=function(t,e,n,i){if(null!==e){var r=this.hitAreaManager.getFirst(e,n),s=r?r.data.key:null;if(this.lastHitAreaKey!==s){if(null!==this.lastHitAreaKey){pt.call(this,"areaout",this.lastHitAreaKey,t,e,n,i);var a=this.hitAreaManager.getByKey(this.lastHitAreaKey);this.urlTagCursorStyle&&a.data.url&&(this.scene.input.manager.canvas.style.cursor=""),a.isDown=!1;}null!==s&&(pt.call(this,"areaover",s,t,e,n,i),this.urlTagCursorStyle&&r.data.url&&(this.scene.input.manager.canvas.style.cursor=this.urlTagCursorStyle)),this.lastHitAreaKey=s;}}else null!==this.lastHitAreaKey&&(pt.call(this,"areaout",this.lastHitAreaKey,t,e,n,i),this.hitAreaManager.getByKey(this.lastHitAreaKey).isDown=!1,this.lastHitAreaKey=null);},pt=function(t,e,n,i,r,s){this.parent.emit("".concat(t,"-").concat(e),n,i,r,s),this.parent.emit(t,e,n,i,r,s);},gt=function(t){return /^[\x00-\x7F]+$/.test(t)},yt=O,vt=M,kt=C,wt=F,xt=L,mt=A,Tt=R,St=function t(e,n,i,r,s,a){r<=0&&(i=wt);var o=[];if(!e||!e.length)return o;for(var h,l,u,c=i===wt,d=e.split(Tt),p=0,g=d.length;p<g;p++)if(h=d[p],u=p===g-1?yt:vt,c){var y=n(h);o.push(a.getLine(h,y,u));}else {if(l=0===p?r-s:r,h.length<=100)if((y=n(h))<=l){o.push(a.getLine(h,y,u));continue}for(var v,k,w,x=bt(h,i),m="",T=0,S=0,b=x.length;S<b;S++)if((k=n(v=x[S]))>r&&Pt(v)){""!==m?o.push(a.getLine(m,T,kt)):0===S&&s>0&&o.push(a.getLine("",0,kt)),o.push.apply(o,f(t(v,n,mt,r,0,a)));var P=o.pop();m=P.text,T=P.width,a.freeLine(P)," "===m&&(m="",T=0);}else (w=T+k)>l?(o.push(a.getLine(m,T,kt)),m=v,T=k,l=r):(m+=v,T=w),S===b-1&&o.push(a.getLine(m,T,u));}return o},bt=function(t,e){var n=[];switch(e){case xt:for(var i=0,r=(t=t.split(" ")).length;i<r;i++){var s=t[i];i<r-1?n.push(s+" "):""!==s&&n.push(s);}break;case mt:n.push.apply(n,f(t.split("")));break;default:for(i=0,r=(t=t.split(" ")).length;i<r;i++){s=t[i];i<r-1?gt(s)?n.push(s+" "):(n.push.apply(n,f(s.split(""))),n.push(" ")):""!==s&&(gt(s)?n.push(s):n.push.apply(n,f(s.split(""))));}}return n},Pt=function(t){switch(t.length){case 1:return !1;case 2:return " "!==t.charAt(1);default:return !0}},Ot=Phaser.Utils.Objects.GetValue,Mt=F,Ct=O,Ft=function(){function t(e){r(this,t),this.parent=e.parent,this.scene=this.parent.scene,this.context=Ot(e,"context",null),this.canvas=this.context.canvas,this.parser=Ot(e,"parser",null),this.defaultStyle=Ot(e,"style",null),this.autoRound=!0,this.pensPool=e.pensPool,this.linesPool=e.linesPool,this.wrapTextLinesPool=e.wrapTextLinesPool,this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new ut,this.lastHitAreaKey=null,this.urlTagCursorStyle=null;var n=this.context;this.getTextWidth=function(t){return n.measureText(t).width};}return a(t,[{key:"destroy",value:function(){this.parent=void 0,this.scene=void 0,this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0),this.pensPool=void 0,this.linesPool=void 0,this.wrapTextLinesPool=void 0;}},{key:"updatePenManager",value:function(t,e,n,i,r){if(void 0===r&&(r=this.penManager),r.clear(),""===t)return r;var s=this.parent.style;if(s.isWrapFitMode){var a=this.parent.padding;n=s.fixedWidth-a.left-a.right;}for(var o,h,l,u,c,f=this.canvas,d=this.context,p=function(t){return d.measureText(t).width},g=0,y=0,v=s.wrapCallback,k=s.wrapCallbackScope,w=!0,x=this.parser.splitText(t),m=this.wrapTextLinesPool,T=0,S=x.length;T<S;T++)if(o=(u=this.parser.tagTextToProp(x[T],h)).plainText,(h=u.prop).img){var b=this.imageManager.getOuterWidth(h.img);n>0&&e!==Mt&&n<g+b&&(r.addNewLinePen(),y+=i,g=0),r.addImagePen(g,y,b,tt(h)),g+=b;}else if(""!==o){if(d.save(),(l=this.parser.propToContextStyle(this.defaultStyle,h)).buildFont(),l.syncFont(f,d),l.syncStyle(f,d),v){"string"==typeof(c=v.call(k,o,p,n,g))&&(c=c.split("\n"));for(var P=0,O=c.length;P<O;P++)"string"==typeof(M=c[P])?c[P]=m.getLine(M,p(M),P<O-1?2:0):w=!1;}else c=St(o,p,e,n,g,m);var M;for(P=0,O=c.length;P<O;P++)M=c[P],r.addTextPen(M.text,g,y,M.width,tt(h),M.newLineMode),M.newLineMode!==Ct?(g=0,y+=i):g+=M.width;w&&m.freeLines(c),c=null,d.restore();}for(T=0,S=this.lines.length;T<S;T++){var C=this.lines[T],F=C[C.length-1];F&&(F.width+=this.parser.getStrokeThinkness(this.defaultStyle,F.prop));}return r}},{key:"startXOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.xOffset}},{key:"startYOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.metrics.ascent}},{key:"lines",get:function(){return this.penManager.lines}},{key:"desplayLinesCount",get:function(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return e>0&&t>e&&(t=e),t}},{key:"linesWidth",get:function(){return Math.ceil(this.penManager.getMaxLineWidth())}},{key:"linesHeight",get:function(){var t=this.desplayLinesCount,e=this.defaultStyle.lineHeight*t;return t>0&&(e-=this.defaultStyle.lineSpacing),e}},{key:"imageManager",get:function(){return this.parent.imageManager}},{key:"rtl",get:function(){return this.parent.style.rtl}},{key:"newPenManager",value:function(){return new st({pensPool:this.pensPool,linesPool:this.linesPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}},{key:"tmpPenManager",get:function(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}},{key:"getPlainText",value:function(t,e,n){var i;if(null==t)i=this.penManager.plainText;else {var r=this.parser.splitText(t,1);i="";for(var s=0,a=r.length;s<a;s++)i+=r[s];}return null==e&&null==n||(null==e&&(e=0),null==n&&(n=i.length),i=i.substring(e,n)),i}},{key:"getPenManager",value:function(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var n=this.defaultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,e),e}},{key:"getText",value:function(t,e,n,i){if(null==t)return this.penManager.getSliceTagText(e,n,i);var r=this.tmpPenManager,s=this.defaultStyle;return this.updatePenManager(t,s.wrapMode,s.wrapWidth,s.lineHeight,r),r.getSliceTagText(e,n,i)}},{key:"copyPenManager",value:function(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}},{key:"getTextWidth",value:function(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}},{key:"getLastPen",value:function(t){return void 0===t&&(t=this.penManager),t.lastPen}}]),t}(),Lt={setInteractive:function(){this.parent.on("pointerdown",ct,this).on("pointerup",ft,this).on("pointermove",dt,this).on("pointerover",dt,this).on("pointerout",(function(t,e){dt.call(this,t,null,null,e);}),this);}};Object.assign(Ft.prototype,N,Lt);var At=function(e){function n(){return r(this,n),t(this,n,arguments)}return o(n,e),a(n,[{key:"freeLine",value:function(t){if(t)return this.push(t),this}},{key:"freeLines",value:function(t){if(t)return this.pushMultiple(t),this}},{key:"getLine",value:function(t,e,n){var i=this.pop();return null===i&&(i={}),i.text=t,i.width=e,i.newLineMode=n,i}}]),n}(ot),Wt=Phaser.Utils.Objects.IsPlainObject,Rt=Phaser.Utils.Objects.GetValue,_t=function(t,e){Wt(t)?t=(e=t).key:void 0===e&&(e={key:t}),e.hasOwnProperty("key")||(e.key=t);var n=e.key,i=e.frame,r=e.width,s=e.height;if(void 0===r||void 0===s){var a=this.textureManager.getFrame(n,i),o=a?a.cutWidth:0,h=a?a.cutHeight:0;void 0===r&&void 0===s?(r=o,s=h):void 0===r?r=o*(s/h):void 0===s&&(s=h*(r/o));}this.images[t]={key:n,frame:i,width:r,height:s,y:Rt(e,"y",0),left:Rt(e,"left",0),right:Rt(e,"right",0),originX:Rt(e,"originX",0),originY:Rt(e,"originY",0),tintFill:Rt(e,"tintFill",!1)};},zt=Phaser.Display.Canvas.CanvasPool,Bt=function(){function t(e){r(this,t),this.textureManager=e.sys.textures,this.images={};}return a(t,[{key:"destroy",value:function(){this.textureManager=void 0,this.images=void 0;}},{key:"add",value:function(t,e){if("string"==typeof t)_t.call(this,t,e);else if(Array.isArray(t))for(var n=0,i=(r=t).length;n<i;n++)_t.call(this,r[n]);else {var r=t;for(var t in r)_t.call(this,t,r[t]);}return this}},{key:"has",value:function(t){return this.images.hasOwnProperty(t)}},{key:"remove",value:function(t){return this.has(t)&&delete this.images[t],this}},{key:"get",value:function(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}},{key:"getOuterWidth",value:function(t){var e=this.get(t);return e?e.width+e.left+e.right:0}},{key:"getFrame",value:function(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}},{key:"hasTexture",value:function(t){return !!this.getFrame(t)}}]),t}(),It={draw:function(t,e,n,i,r,s){var a=this.get(t),o=this.textureManager.getFrame(a.key,a.frame),h=a.width,l=a.height;n+=a.left-a.originX*h,i+=a.y-a.originY*l,a.tintFill||(r=void 0),function(t,e,n,i,r,s,a,o){void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=t.cutWidth),void 0===s&&(s=t.cutHeight),void 0===o&&(o=!1),o&&(n=Math.round(n),i=Math.round(i));var h=e.getContext("2d",{willReadFrequently:!0});if(a){var l=zt.create(null,r,s,Phaser.CANVAS,!0),u=l.getContext("2d",{willReadFrequently:!0});u.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,0,0,r,s),u.globalCompositeOperation="source-in",u.fillStyle=a,u.fillRect(0,0,r,s),h.drawImage(l,0,0,r,s,n,i,r,s),zt.remove(l);}else h.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,n,i,r,s);}(o,e.canvas,n,i,h,l,r,s);}};Object.assign(Bt.prototype,It);var jt=Phaser.Utils.Objects.IsPlainObject,Ht=Phaser.DOM.AddToDOM,Xt=Phaser.Display.Canvas.CanvasPool,Gt=Phaser.GameObjects.GameObject,Yt=Phaser.Utils.Objects.GetValue,Dt=Phaser.DOM.RemoveFromDOM,Ut=R,Kt=Phaser.Utils.String.UUID,Vt=null,Et=null,Nt=null,Jt=function(e){function n(e,i,s,a,o,h,l){var c;if(r(this,n),jt(i)){var f=i;i=Yt(f,"x",0),s=Yt(f,"y",0),a=Yt(f,"text",""),o=Yt(f,"style");}if(void 0===i&&(i=0),void 0===s&&(s=0),(c=t(this,n,[e,h])).renderer=e.sys.game.renderer,c.setPosition(i,s),c.setOrigin(0,0),c.initPipeline(),c.initPostPipeline(!0),c.canvas=Xt.create(u(c)),c.context=c.canvas.getContext("2d",{willReadFrequently:!0}),c._imageManager=void 0,o){if(o.hasOwnProperty("align")){var d=o.align;delete o.align,o.halign=d;}o.hasOwnProperty("stroke")&&!o.hasOwnProperty("strokeThickness")&&(o.strokeThickness=1);}c.style=new B(u(c),o);var p,g,y,v=Yt(o,"images",void 0);return v&&c.addImage(v),c.autoRound=!0,c._text=void 0,c.padding={left:0,right:0,top:0,bottom:0},c.width=1,c.height=1,c.lineSpacing=0,c.dirty=!1,0===c.style.resolution&&(c.style.resolution=1),c._crop=c.resetCropObject(),c._textureKey=Kt(),c.texture=e.sys.textures.addCanvas(c._textureKey,c.canvas),c.frame=c.texture.get(),c.frame.source.resolution=c.style.resolution,c.renderer&&c.renderer.gl&&(c.renderer.deleteTexture(c.frame.source.glTexture),c.frame.source.glTexture=null),Yt(o,"sharedPool",!0)?(Vt||(Vt={},Et=new ot,Nt=new At,c.scene.game.events.once("destroy",(function(){Vt=null,Et=null,Nt=null;}))),Vt.hasOwnProperty(h)||(Vt[h]=new ot),p=Vt[h],g=Et,y=Nt):(p=new ot,g=new ot,y=new At),c.canvasText=new Ft({parent:u(c),context:c.context,parser:l,style:c.style,pensPool:p,linesPool:g,wrapTextLinesPool:y}),c.parser=l,c.initRTL(),o&&o.padding&&c.setPadding(o.padding),o&&o.lineSpacing&&c.setLineSpacing(o.lineSpacing),c.setText(a),c.setUrlTagCursorStyle(Yt(o,"urlTagCursorStyle","pointer")),Yt(o,"interactive",!1)&&c.setInteractive(),c}return o(n,e),a(n,[{key:"preDestroy",value:function(){Dt(this.canvas),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),Xt.remove(this.canvas);var t=this.texture;t&&t.destroy();}},{key:"text",get:function(){return this._text},set:function(t){this.setText(t);}},{key:"initRTL",value:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Ht(this.canvas,this.scene.sys.canvas),this.originX=1);}},{key:"setRTL",value:function(t){void 0===t&&(t=!0);var e=this.style;if(e.rtl===t)return this;if(e.rtl=t,t?(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Ht(this.canvas,this.scene.sys.canvas)):(this.canvas.dir="ltr",this.context.direction="ltr"),"left"===e.halign?e.halign="right":"right"===e.halign&&(e.halign="left"),this._imageManager){var n=this._imageManager.images;for(var i in n)n[i].originX=1-n[i].originX;}return this}},{key:"setText",value:function(t){return (t=null==t?"":Array.isArray(t)?t.join("\n"):t.toString())===this._text||(this._text=t,this.updateText()),this}},{key:"setPadding",value:function(t,e,n,r){if("object"===i(t)){var s=t,a=Yt(s,"x",null);null!==a?(t=a,n=a):(t=Yt(s,"left",0),n=Yt(s,"right",t));var o=Yt(s,"y",null);null!==o?(e=o,r=o):(e=Yt(s,"top",0),r=Yt(s,"bottom",e));}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===n&&(n=t),void 0===r&&(r=e);return this.padding.left=t,this.padding.top=e,this.padding.right=n,this.padding.bottom=r,this.updateText(!1)}},{key:"updateText",value:function(t){void 0===t&&(t=!0);var e=this.canvasText,n=this.style;t&&e.updatePenManager(this._text,n.wrapMode,n.wrapWidth,n.lineHeight);var r,s,a=this.padding,o=Math.ceil(e.linesWidth);0===n.fixedWidth?(this.width=o+a.left+a.right,r=o):(this.width=n.fixedWidth,(r=this.width-a.left-a.right)<o&&(r=o)),0===n.fixedHeight?(this.height=e.linesHeight+a.top+a.bottom,s=e.linesHeight):(this.height=n.fixedHeight,(s=this.height-a.top-a.bottom)<e.linesHeight&&(s=e.linesHeight));var h=this.width,l=this.height;this.updateDisplayOrigin();var u=n.resolution;h*=u,l*=u,h=Math.max(Math.ceil(h),1),l=Math.max(Math.ceil(l),1);var c=this.canvas,f=this.context;c.width!==h||c.height!==l?(c.width=h,c.height=l,this.frame.setSize(h,l)):f.clearRect(0,0,h,l),f.save(),f.scale(u,u);var d=this.style.rtl?a.right:a.left,p=a.top;e.draw(d,p,r,s),f.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(c,this.frame.source.glTexture,!0),("undefined"==typeof WEBGL_DEBUG||i(WEBGL_DEBUG))&&(this.frame.glTexture.spectorMetadata={textureKey:"BBCodeText Game Object"})),this.dirty=!0;var g=this.input;return g&&!g.customHitArea&&(g.hitArea.width=this.width,g.hitArea.height=this.height),this}},{key:"toJSON",value:function(){var t=Components.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}},{key:"setInteractive",value:function(t,e,n){var i=!!this.input;return Gt.prototype.setInteractive.call(this,t,e,n),i||this.canvasText.setInteractive(),this}},{key:"setUrlTagCursorStyle",value:function(t){return this.urlTagCursorStyle=t,this}},{key:"urlTagCursorStyle",get:function(){return this.canvasText.urlTagCursorStyle},set:function(t){this.canvasText.urlTagCursorStyle=t;}},{key:"getWrappedText",value:function(t,e,n){return "number"==typeof t&&(n=e,e=t,t=void 0),(t=this.canvasText.getText(t,e,n,!0)).split(Ut)}},{key:"getPlainText",value:function(t,e,n){return "number"==typeof t&&(n=e,e=t,t=void 0),this.canvasText.getPlainText(t,e,n)}},{key:"getText",value:function(t,e,n,i){return "number"==typeof t&&(i=n,n=e,e=t,t=void 0),void 0===i&&(i=!1),this.canvasText.getText(t,e,n,i)}},{key:"getSubString",value:function(t,e,n){return "number"==typeof t&&(n=e,e=t,t=void 0),this.getText(t,e,n)}},{key:"copyPenManager",value:function(t){return this.canvasText.copyPenManager(t)}},{key:"getPenManager",value:function(t,e){return this.canvasText.getPenManager(t,e)}},{key:"setSize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"resize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"imageManager",get:function(){return this._imageManager||(this._imageManager=new Bt(this.scene)),this._imageManager}},{key:"addImage",value:function(t,e){return this.imageManager.add(t,e),this}},{key:"drawAreaBounds",value:function(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}},{key:"generateTexture",value:function(t,e,n,i,r){var s=this.canvas;return void 0===i?i=s.width:i*=this.resolution,void 0===r?r=s.height:r*=this.resolution,function(t,e,n,i,r,s,a){var o,h=t.sys.textures,l=t.renderer;void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=e.width),void 0===a&&(a=e.height);var u=(o=h.exists(n)?h.get(n):h.createCanvas(n,s,a)).getSourceImage();u.width!==s&&(u.width=s),u.height!==a&&(u.height=a);var c=u.getContext("2d",{willReadFrequently:!0});c.clearRect(0,0,s,a),c.drawImage(e,i,r,s,a),l.gl&&o&&l.canvasToTexture(u,o.source[0].glTexture,!0,0);}(this.scene,s,t,e,n,i,r),this}}]),n}(w),qt={appendText:function(t,e){var n;return t||0===t||(t=""),void 0===e&&(e=!0),Array.isArray(t)&&(t=t.join("\n")),(n=e?"".concat(this.text,"\n").concat(t):"".concat(this.text).concat(t))!=this.text&&this.setText(n),this}};Object.assign(Jt.prototype,qt);var $t={plainText:null,prevProp:null},Qt=new B,Zt=function(){function t(e){r(this,t),void 0===e&&(e={}),this.tags=e;}return a(t,[{key:"addTag",value:function(t,e){this.tags[t]=e;}},{key:"getTag",value:function(t){return this.tags[t]}},{key:"splitText",value:function(t,e){for(var n=[],i=0;;){var r=ne.exec(t);if(!r)break;var s=r[0],a=ne.lastIndex-s.length;if(i<a&&n.push(t.substring(i,a)),void 0===e)n.push(s);else if(1===e)if(ie.test(s)){var o=s.match(re);n.push(o[2]);}else if(se.test(s)){o=s.match(ae);n.push(o[2]);}i=ne.lastIndex;}var h=t.length;return i<h&&n.push(t.substring(i,h)),n}},{key:"tagTextToProp",value:function(t,e){var n,i;if(ie.test(t)){if(null!=(a=t.match(re))){var r=a[1],s=this.tags;(i=s.hasOwnProperty(r)?s[r]:{})._class=r,n=a[2];}}else if(se.test(t)){var a;if(null!=(a=t.match(ae))){var o=a[1];(i=te(o))._style=o,n=a[2];}}null==n&&(n=t),null==i&&(i={});var h=$t;return h.plainText=n,h.prop=i,h}},{key:"propToContextStyle",value:function(t,e){var n=Qt;if(e.hasOwnProperty("img"))n.image=e.img;else {if(n.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var i=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];n.fontFamily=i;}else n.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var r=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof r&&(r="".concat(r,"px")),n.fontSize=r;}else n.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var s=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];n.fontStyle=s;}else n.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){var a=e.hasOwnProperty("color")?e.color:e["font-color"];n.color=a;}else n.color=t.color;if(e.hasOwnProperty("stroke")){var o=e.stroke;n.stroke=o.hasOwnProperty("color")?o.color:t.stroke,n.strokeThickness=o.hasOwnProperty("thickness")?o.thickness:t.strokeThickness;}else n.stroke=t.stroke,n.strokeThickness=t.strokeThickness;}if(e.hasOwnProperty("shadow")){var h=e.shadow;n.shadowColor=h.hasOwnProperty("color")?h.color:t.shadowColor,n.shadowOffsetX=h.hasOwnProperty("offsetX")?h.offsetX:t.shadowOffsetX,n.shadowOffsetY=h.hasOwnProperty("offsetY")?h.offsetY:t.shadowOffsetY,n.shadowBlur=h.hasOwnProperty("blur")?h.blur:t.shadowBlur,n.shadowStroke=!0,n.shadowFill=!0;}else n.shadowColor=t.shadowColor,n.shadowOffsetX=t.shadowOffsetX,n.shadowOffsetY=t.shadowOffsetY,n.shadowBlur=t.shadowBlur,n.shadowStroke=t.shadowStroke,n.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var l=e.hasOwnProperty("u")?e.u:e.underline;n.underlineColor=l.hasOwnProperty("color")?l.color:t.underlineColor,n.underlineThickness=l.hasOwnProperty("thickness")?l.thickness:t.underlineThickness,n.underlineOffset=l.hasOwnProperty("offset")?l.offset:t.underlineOffset;}else n.underlineColor=t.underlineColor,n.underlineThickness=t.underlineThickness,n.underlineOffset=t.underlineOffset;if(e.hasOwnProperty("s")||e.hasOwnProperty("strikethrough")){var u=e.hasOwnProperty("s")?e.s:e.strikethrough;n.strikethroughColor=u.hasOwnProperty("color")?u.color:t.strikethroughColor,n.strikethroughThickness=u.hasOwnProperty("thickness")?u.thickness:t.strikethroughThickness,n.strikethroughOffset=u.hasOwnProperty("offset")?u.offset:t.strikethroughOffset;}else n.strikethroughColor=t.strikethroughColor,n.strikethroughThickness=t.strikethroughThickness,n.strikethroughOffset=t.strikethroughOffset;return n}},{key:"getStrokeThinkness",value:function(t,e){var n;if(e.hasOwnProperty("stroke")){var i=e.stroke;n=i.hasOwnProperty("thickness")?i.thickness:t.strokeThickness;}else n=t.strokeThickness;return n}},{key:"propToTagText",value:function(t,e,n){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='".concat(e._class,"'>").concat(t,"</class>"):e.hasOwnProperty("_style")?"<style='".concat(e._style,"'>").concat(t,"</style>"):t}},{key:"destroy",value:function(){this.tags=void 0;}},{key:"isTextTag",value:function(t){var e=this.tags[t];return !!e&&null==e.img}}]),t}(),te=function(t){for(var e,n,i,r={},s=0,a=(t=t.split(";")).length;s<a;s++)if(n=(e=t[s].split(":"))[0],i=e[1],!ee(n)&&!ee(i)){switch(n){case"stroke":var o=i.split(" ");i={},(h=o.length)>=1&&(i.color=o[0]),h>=2&&(i.thickness=parseInt(o[1].replace("px","")));break;case"shadow":o=i.split(" ");i={},(h=o.length)>=1&&(i.color=o[0]),h>=2&&(i.offsetX=parseInt(o[1].replace("px",""))),h>=3&&(i.offsetY=parseInt(o[2].replace("px",""))),h>=4&&(i.blur=parseInt(o[3].replace("px","")));break;case"u":case"underline":case"s":case"strikethrough":var h;o=i.split(" ");i={},(h=o.length)>=1&&(i.color=o[0]),h>=2&&(i.thickness=parseInt(o[1].replace("px",""))),h>=3&&(i.offset=parseInt(o[2].replace("px",""))),"underline"===n?n="u":"strikethrough"===n&&(n="s");break;case"y":i=parseFloat(i);}r[n]=i;}return r},ee=function(t){return 0===(t=t.replace(oe,"")).length},ne=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,ie=/<\s*class=/i,re=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,se=/<\s*style=/i,ae=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,oe=/^\s+|\s+$/,he=Phaser.Utils.Objects.GetValue,le=function(e){function n(e,i,s,a,o){r(this,n);var h=he(o,"tags",void 0);return t(this,n,[e,i,s,a,o,"rexTagText",new Zt(h)])}return o(n,e),a(n,[{key:"addTag",value:function(t,e){return this.parser.addTag(t,e),this.updateText(!0)}},{key:"addTags",value:function(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}},{key:"getTag",value:function(t){return this.parser.getTag(t)}},{key:"preDestroy",value:function(){c(h(n.prototype),"preDestroy",this).call(this),this.parser.destroy(),this.parser=void 0;}}]),n}(Jt);function ue(t,e,n,i){var r=new le(this.scene,t,e,n,i);return this.scene.add.existing(r),r}var ce=Phaser.Utils.Objects.GetAdvancedValue,fe=Phaser.GameObjects.BuildGameObject;function de(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var n=ce(t,"text",""),i=ce(t,"style",null),r=ce(t,"padding",null);null!==r&&(i.padding=r);var s=new le(this.scene,0,0,n,i);return fe(this.scene,s,t),s.autoRound=ce(t,"autoRound",!0),s}var pe=function(t){return null==t||""===t||0===t.length},ge=function(e){function n(e){var i;return r(this,n),i=t(this,n,[e]),e.registerGameObject("rexTagText",ue,de),i}return o(n,Phaser.Plugins.BasePlugin),a(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this);}}]),n}();return function(t,e,n,r){if(void 0===r&&(r="."),"object"===i(t)){if(pe(e)){if(null==n)return;"object"===i(n)&&(t=n);}else {"string"==typeof e&&(e=e.split(r));var s=e.pop(),a=function(t,e,n){var r=t;if(pe(e));else {var s;"string"==typeof e&&(e=e.split("."));for(var a=0,o=e.length;a<o;a++){var h;null!=r[s=e[a]]&&"object"===i(r[s])||(h=a===o-1?void 0===n?{}:n:{},r[s]=h),r=r[s];}}return r}(t,e);a[s]=n;}}}(window,"RexPlugins.GameObjects.TagText",le),ge}));
