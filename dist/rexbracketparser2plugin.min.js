var t,e;t=void 0,e=function(){function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function s(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function r(t,e,s,r,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new i(s,r||t,o),h=n?n+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,s,i=[];if(0===this._eventsCount)return i;for(s in t=this._events)e.call(t,s)&&i.push(n?s.slice(1):s);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=n?n+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var i=0,r=s.length,o=new Array(r);i<r;i++)o[i]=s[i].fn;return o},a.prototype.listenerCount=function(t){var e=n?n+t:t,s=this._events[e];return s?s.fn?1:s.length:0},a.prototype.emit=function(t,e,s,i,r,o){var a=n?n+t:t;if(!this._events[a])return!1;var h,u,l=this._events[a],v=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),v){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,s),!0;case 4:return l.fn.call(l.context,e,s,i),!0;case 5:return l.fn.call(l.context,e,s,i,r),!0;case 6:return l.fn.call(l.context,e,s,i,r,o),!0}for(u=1,h=new Array(v-1);u<v;u++)h[u-1]=arguments[u];l.fn.apply(l.context,h)}else{var c,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),v){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,s);break;case 4:l[u].fn.call(l[u].context,e,s,i);break;default:if(!h)for(c=1,h=new Array(v-1);c<v;c++)h[c-1]=arguments[c];l[u].fn.apply(l[u].context,h)}}return!0},a.prototype.on=function(t,e,n){return r(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return r(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,s,i){var r=n?n+t:t;if(!this._events[r])return this;if(!e)return o(this,r),this;var a=this._events[r];if(a.fn)a.fn!==e||i&&!a.once||s&&a.context!==s||o(this,r);else{for(var h=0,u=[],l=a.length;h<l;h++)(a[h].fn!==e||i&&!a[h].once||s&&a[h].context!==s)&&u.push(a[h]);u.length?this._events[r]=1===u.length?u[0]:u:o(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&o(this,e)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}(e);var n=t(e.exports);class s extends n{shutdown(){this.removeAllListeners()}destroy(){this.removeAllListeners()}}var i={setEventEmitter(t,e){return void 0===e&&(e=s),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},r=function(t,e,n,s){var i=t&&("object"==typeof t||"function"==typeof t),r=s&&("object"==typeof s||"function"==typeof s);if(!i&&!r)return n;var a=String(e);if(i&&a in t)return t[a];if(r&&a in s)return s[a];if(-1===a.indexOf("."))return n;var h=a.split(".");if(i){var u=o(t,h,n);if(u.found)return u.value}if(r){var l=o(s,h,n);if(l.found)return l.value}return n},o=function(t,e,n){for(var s=t,i=n,r=0,o=e.length;r<o;r++){var h=e[r];if(!s||"object"!=typeof s&&"function"!=typeof s||!(h in s))return a.found=!1,a;s=i=s[h]}return a.found=!0,a.value=i,a},a={},h=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,u=/^0x[0-9A-F]+$/i,l=function(t){if("string"!=typeof t)return t;if(""===t)t=null;else if(h.test(t))t=parseFloat(t);else if(u.test(t))t=parseInt(t,16);else switch(t){case"false":t=!1;break;case"true":t=!0;break;case"null":t=null;break;case"undefined":t=void 0}return t},v=function(t){return t.replace(c,"\\$&").replace(p,"\\x2d")},c=/[|\\{}()[\]^$+*?.]/g,p=/-/g;let f=class{constructor(t){this.setEventEmitter(r(t,"eventEmitter",void 0)),this.setValueConverter(r(t,"valueConvert",!0)),this.setLoopEnable(r(t,"loop",!1)),this.setMultipleLinesTagEnable(r(t,"multipleLinesTag",!1));var e=r(t,"delimiters","<>");this.setDelimiters(e[0],e[1]),this.setTranslateTagNameCallback(r(t,"translateTagNameCallback")),this.isRunning=!1,this.isPaused=!1,this.skipEventFlag=!1,this.justCompleted=!1,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null}shutdown(){this.destroyEventEmitter()}destroy(){this.shutdown()}setMultipleLinesTagEnable(t){return void 0===t&&(t=!0),this.multipleLinesTagEnable=t,this}setDelimiters(t,e){void 0===e&&(e=t[1],t=t[0]),this.delimiterLeft=t,this.delimiterRight=e,t=v(this.delimiterLeft),e=v(this.delimiterRight);var n=this.multipleLinesTagEnable?"gs":"gi";return this.reSplit=RegExp(`${t}(.+?)${e}`,n),this}setTranslateTagNameCallback(t){return this.translateTagNameCallback=t,this}setValueConverter(t){return!0===t?t=l:t||(t=m),this.valueConverter=t,this}setLoopEnable(t){return void 0===t&&(t=!0),this.loopEnable=t,this}setSource(t){return this.source=t,this}resetIndex(t){return void 0===t&&(t=0),this.progressIndex=t,this.reSplit.lastIndex=t,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null,this.justCompleted=!1,this.isRunning=!1,this}start(t){return this.setSource(t).restart(),this}restart(){this.resetIndex().next()}next(){if(this.isPaused&&this.onResume(),this.isRunning)return this;if(this.isRunning=!0,this.justCompleted)return this.isRunning=!1,this;0===this.reSplit.lastIndex&&this.onStart();var t=this.source,e=t.length;for(this.reSplit.lastIndex=this.progressIndex;;){var n=this.reSplit.exec(t);if(!n){if(this.progressIndex<e&&(this.onContent(t.substring(this.progressIndex,e)),this.isPaused)){this.progressIndex=e;break}return this.onComplete(),void(this.isRunning=!1)}var s=this.reSplit.lastIndex,i=s-n[0].length;if(this.progressIndex<i&&(this.onContent(t.substring(this.progressIndex,i)),this.isPaused)){this.progressIndex=i;break}if(this.lastTagSource=n[0],this.onTag(n[1]),this.lastTagSource=void 0,this.progressIndex=s,this.isPaused)break}return this.isRunning=!1,this}skipEvent(){return this.skipEventFlag=!0,this}pause(){return this.isPaused||this.onPause(),this}pauseUntilEvent(t,e){return this.isPaused||(this.pause(),t.once(e,(function(){this.next()}),this)),this}onContent(t){this.skipEventFlag=!1,this.emit("content",t),this.lastContent=t}onTag(t){}onStart(){this.isRunning=!0,this.emit("start",this)}onComplete(){this.isRunning=!1,this.justCompleted=!0,this.emit("complete",this),this.loopEnable&&this.resetIndex()}onPause(){this.isPaused=!0,this.emit("pause",this)}onResume(){this.isPaused=!1,this.emit("resume",this)}};const m=function(t){return t};Object.assign(f.prototype,i);var d=function(t,e){if(null==t)return null;var n=t.length-1,s=t.charAt(0),i=t.charAt(n);if('"'===s&&'"'===i||'"'===s&&'"'===i)return t.substring(1,n);if("["===s&&"]"===i||"{"===s&&"}"===i)try{return JSON.parse(t)}catch{return t}return e(t)};class g extends f{constructor(t){void 0===t&&(t={}),t.hasOwnProperty("multipleLinesTag")||(t.multipleLinesTag=!0),super(t)}setDelimiters(t,e){return super.setDelimiters(t,e),this.reTagName=RegExp(C,"i"),this.reParamPair=RegExp(L,"gi"),this}onTag(t){var e=(s=t.match(this.reTagName))[1];this.translateTagNameCallback&&(e=this.translateTagNameCallback(e)),this.reParamPair.lastIndex=s.index+s[0].length;for(var n={};;){var s;if(!(s=this.reParamPair.exec(t)))break;n[s[1]]=d(s[2],this.valueConverter)}var i="/"===e.charAt(0);i&&(e=e.substring(1,e.length));var r=i?"-":"+";this.skipEventFlag=!1,this.emit(`${r}${e}`,n),this.skipEventFlag||this.emit(r,e,n),i?this.lastTagEnd=e:this.lastTagStart=e}}var E=function(t,e){return void 0===e&&(e=t),`${t=v(t)}[^${t}${e=v(e)}]+${e}`};const _="[^ =\n]+",y=`${E('"')}|${E("'")}`,x=E("[","]"),b=E("{","}"),T="[ \n]*",C=`${T}(${_})${T}`,L=`(${_})${T}=${T}(${y}|${x}|${b}|${_})${T}`;class P extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.on("destroy",this.destroy,this)}add(t){return new g(t)}}return P},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexbracketparser2plugin=e();
