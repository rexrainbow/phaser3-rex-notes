var e,r;e=void 0,r=function(){const e="rexFilterColorReplace";class r extends Phaser.Renderer.WebGL.RenderNodes.BaseFilterShader{static FilterName=e;constructor(r){super(e,r,null,"#pragma phaserTemplate(shaderName)\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n\n// Scene buffer\nuniform sampler2D uMainSampler; \nvarying vec2 outTexCoord;\n\n// Effect parameters\nuniform float epsilon;\nuniform vec3 originalColor;\nuniform vec3 newColor;\n\n#pragma phaserTemplate(fragmentHeader)\n\nvoid main (void) {\n  vec4 currentColor = texture2D(uMainSampler, outTexCoord);\n  vec3 colorDiff = originalColor - (currentColor.rgb / max(currentColor.a, 0.0000000001));\n  float colorDistance = length(colorDiff);\n  float doReplace = step(colorDistance, epsilon);\n  gl_FragColor = vec4(mix(currentColor.rgb, (newColor + colorDiff) * currentColor.a, doReplace), currentColor.a);\n}\n")}setupUniforms(e,r){const o=this.programManager;o.setUniform("epsilon",e.epsilon),o.setUniform("originalColor",[e._originalColor.redGL,e._originalColor.greenGL,e._originalColor.blueGL]),o.setUniform("newColor",[e._newColor.redGL,e._newColor.greenGL,e._newColor.blueGL])}}const o=Phaser.Utils.Objects.GetValue,n=Phaser.Display.Color.IntegerToRGB,t=Phaser.Display.Color;class i extends Phaser.Filters.Controller{static FilterName=e;constructor(r,o){super(r,e),this.epsilon=.4,this._originalColor=new t,this._newColor=new t,this.resetFromJSON(o)}resetFromJSON(e){return this.setEpsilon(o(e,"epsilon",.4)),this.setOriginalColor(o(e,"originalColor",16711680)),this.setNewColor(o(e,"newColor",0)),this}setEpsilon(e){return this.epsilon=e,this}get originalColor(){return this._originalColor}set originalColor(e){"number"==typeof e&&(e=n(e)),this._originalColor.setFromRGB(e)}setOriginalColor(e){return this.originalColor=e,this}get newColor(){return this._newColor}set newColor(e){"number"==typeof e&&(e=n(e)),this._newColor.setFromRGB(e)}setNewColor(e){return this.newColor=e,this}}const s=Phaser.Game;var l=function(e){return e instanceof s};const a=Phaser.Scene;var c=function(e){return e instanceof a},u=function(e,r){var o,n=r.FilterName,t=(o=e,null==o||"object"!=typeof o?null:l(o)?o:l(o.game)?o.game:c(o)?o.sys.game:c(o.scene)?o.scene.sys.game:void 0).renderer.renderNodes;t.hasNode(n)||t.addNodeConstructor(n,r)},f=function(e,r){return void 0===r&&(r=!1),e.filters||e.enableFilters().focusFilters(),r?e.filters.external:e.filters.internal};const h=Phaser.Utils.Array.SpliceOne;class d extends Phaser.Plugins.BasePlugin{setFilterClass(e,r){return this.FilterClass=e,this.ControllerClass=r,this}setFilterListMethod(e,r){return function(e,r){var o=Phaser.GameObjects.Components.FilterList.prototype;o[e]?console.warn(`FilterList method: ${e} is already defined`):o[e]=r}(e,r),this}start(){var e=this.game.events;e.once("destroy",this.destroy,this),this.game.isRunning?u(this.game,this.FilterClass):e.once("ready",(function(){u(this.game,this.FilterClass)}),this)}add(e,r,o=!1){return function(e,r,o,n){void 0===o&&(o={});var t=f(e,n),i=t.add(new r(t.camera,o));return o.name&&(i.name=o.name),i}(e,this.ControllerClass,r,o)}remove(e,r,o=!1){return function(e,r,o,n){var t=f(e,n).list;if(void 0===o)for(var i=t.length-1;i>=0;i--)(l=t[i])instanceof r&&(l.destroy(),h(l,i));else{i=0;for(var s=t.length;i<s;i++){var l;(l=t[i])instanceof r&&l.name===o&&(l.destroy(),h(l,i))}}}(e,this.ControllerClass,r,o),this}get(e,r,o=!1){return function(e,r,o,n){var t=f(e,n).list;if(void 0===o){for(var i=[],s=0,l=t.length;s<l;s++)(a=t[s])instanceof r&&i.push(a);return i}for(s=0,l=t.length;s<l;s++){var a;if((a=t[s])instanceof r&&a.name===o)return a}}(e,this.ControllerClass,r,o)}}var p=function(e){return null==e||""===e||0===e.length},C=function(e,r,o,n){if(void 0===n&&(n="."),"object"==typeof e){if(p(r)){if(null==o)return;"object"==typeof o&&(e=o)}else{"string"==typeof r&&(r=r.split(n));var t=r.pop(),i=function(e,r,o){var n=e;if(p(r));else{var t;"string"==typeof r&&(r=r.split("."));for(var i=0,s=r.length;i<s;i++){var l;null!=n[t=r[i]]&&"object"==typeof n[t]||(l=i===s-1?void 0===o?{}:o:{},n[t]=l),n=n[t]}}return n}(e,r);i[t]=o}return e}};return C(window,"RexPlugins.Filters.ColorReplaceFilter",r),C(window,"RexPlugins.Filters.ColorReplaceController",i),class extends d{constructor(e){super(e),this.setFilterClass(r,i),this.setFilterListMethod("addRexColorReplace",(function(e){return this.add(new i(this.camera,e))}))}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).rexcolorreplacefilterplugin=r();
