var t,e;t=void 0,e=function(){function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,s="~";function i(){}function n(t,e,s){this.fn=t,this.context=e,this.once=s||!1}function r(t,e,i,r,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new n(i,r||t,o),h=s?s+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),a.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(s?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=s?s+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},a.prototype.listenerCount=function(t){var e=s?s+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,n,r,o){var a=s?s+t:t;if(!this._events[a])return!1;var h,l,u=this._events[a],p=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),p){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,r),!0;case 6:return u.fn.call(u.context,e,i,n,r,o),!0}for(l=1,h=new Array(p-1);l<p;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var v,c=u.length;for(l=0;l<c;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),p){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;case 4:u[l].fn.call(u[l].context,e,i,n);break;default:if(!h)for(v=1,h=new Array(p-1);v<p;v++)h[v-1]=arguments[v];u[l].fn.apply(u[l].context,h)}}return!0},a.prototype.on=function(t,e,s){return r(this,t,e,s,!1)},a.prototype.once=function(t,e,s){return r(this,t,e,s,!0)},a.prototype.removeListener=function(t,e,i,n){var r=s?s+t:t;if(!this._events[r])return this;if(!e)return o(this,r),this;var a=this._events[r];if(a.fn)a.fn!==e||n&&!a.once||i&&a.context!==i||o(this,r);else{for(var h=0,l=[],u=a.length;h<u;h++)(a[h].fn!==e||n&&!a[h].once||i&&a[h].context!==i)&&l.push(a[h]);l.length?this._events[r]=1===l.length?l[0]:l:o(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=s?s+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,t.exports=a}(e);var s=t(e.exports);class i extends s{shutdown(){this.removeAllListeners()}destroy(){this.removeAllListeners()}}var n={setEventEmitter(t,e){return void 0===e&&(e=i),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},r=function(t,e,s){if(!t||"number"==typeof t)return s;if("string"==typeof e){if(t.hasOwnProperty(e))return t[e];if(-1===e.indexOf("."))return s;e=e.split(".")}for(var i=e,n=t,r=s,o=0;o<i.length;o++){if(e=i[o],!n.hasOwnProperty(e)){r=s;break}n=r=n[e]}return r},o=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,a=/^0x[0-9A-F]+$/i,h=function(t){if("string"!=typeof t)return t;if(""===t)t=null;else if(o.test(t))t=parseFloat(t);else if(a.test(t))t=parseInt(t,16);else switch(t){case"false":t=!1;break;case"true":t=!0;break;case"null":t=null;break;case"undefined":t=void 0}return t},l=function(t){return t.replace(u,"\\$&").replace(p,"\\x2d")},u=/[|\\{}()[\]^$+*?.]/g,p=/-/g;let v=class{constructor(t){this.setEventEmitter(r(t,"eventEmitter",void 0)),this.setValueConverter(r(t,"valueConvert",!0)),this.setLoopEnable(r(t,"loop",!1)),this.setMultipleLinesTagEnable(r(t,"multipleLinesTag",!1));var e=r(t,"delimiters","<>");this.setDelimiters(e[0],e[1]),this.setTranslateTagNameCallback(r(t,"translateTagNameCallback")),this.isRunning=!1,this.isPaused=!1,this.skipEventFlag=!1,this.justCompleted=!1,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null}shutdown(){this.destroyEventEmitter()}destroy(){this.shutdown()}setMultipleLinesTagEnable(t){return void 0===t&&(t=!0),this.multipleLinesTagEnable=t,this}setDelimiters(t,e){void 0===e&&(e=t[1],t=t[0]),this.delimiterLeft=t,this.delimiterRight=e,t=l(this.delimiterLeft),e=l(this.delimiterRight);var s=this.multipleLinesTagEnable?"gs":"gi";return this.reSplit=RegExp(`${t}(.+?)${e}`,s),this}setTranslateTagNameCallback(t){return this.translateTagNameCallback=t,this}setValueConverter(t){return!0===t?t=h:t||(t=c),this.valueConverter=t,this}setLoopEnable(t){return void 0===t&&(t=!0),this.loopEnable=t,this}setSource(t){return this.source=t,this}resetIndex(t){return void 0===t&&(t=0),this.progressIndex=t,this.reSplit.lastIndex=t,this.lastTagStart=null,this.lastTagEnd=null,this.lastContent=null,this.justCompleted=!1,this.isRunning=!1,this}start(t){return this.setSource(t).restart(),this}restart(){this.resetIndex().next()}next(){if(this.isPaused&&this.onResume(),this.isRunning)return this;if(this.isRunning=!0,this.justCompleted)return this.isRunning=!1,this;0===this.reSplit.lastIndex&&this.onStart();var t=this.source,e=t.length;for(this.reSplit.lastIndex=this.progressIndex;;){var s=this.reSplit.exec(t);if(!s){if(this.progressIndex<e&&(this.onContent(t.substring(this.progressIndex,e)),this.isPaused)){this.progressIndex=e;break}return this.onComplete(),void(this.isRunning=!1)}var i=this.reSplit.lastIndex,n=i-s[0].length;if(this.progressIndex<n&&(this.onContent(t.substring(this.progressIndex,n)),this.isPaused)){this.progressIndex=n;break}if(this.lastTagSource=s[0],this.onTag(s[1]),this.lastTagSource=void 0,this.progressIndex=i,this.isPaused)break}return this.isRunning=!1,this}skipEvent(){return this.skipEventFlag=!0,this}pause(){return this.isPaused||this.onPause(),this}pauseUntilEvent(t,e){return this.isPaused||(this.pause(),t.once(e,(function(){this.next()}),this)),this}onContent(t){this.skipEventFlag=!1,this.emit("content",t),this.lastContent=t}onTag(t){}onStart(){this.isRunning=!0,this.emit("start",this)}onComplete(){this.isRunning=!1,this.justCompleted=!0,this.emit("complete",this),this.loopEnable&&this.resetIndex()}onPause(){this.isPaused=!0,this.emit("pause",this)}onResume(){this.isPaused=!1,this.emit("resume",this)}};const c=function(t){return t};Object.assign(v.prototype,n);class f extends v{constructor(t){void 0===t&&(t={}),t.hasOwnProperty("multipleLinesTag")||(t.multipleLinesTag=!1),super(t),this.setTagExpression(r(t,"regex.tag",void 0)),this.setValueExpression(r(t,"regex.value",void 0));var e=r(t,"delimiters","<>");this.setDelimiters(e[0],e[1])}setTagExpression(t){return t||(t=m),this.tagExpression=t,this}setValueExpression(t){return t||(t=m),this.valueExpression=t,this}setDelimiters(t,e){super.setDelimiters(t,e);var s=`(${this.tagExpression})(=(${this.valueExpression}))?`;if(this.reTag=RegExp(s,"i"),this.tagExpression!==m||this.valueExpression!==m){var i=`${this.tagExpression}(=${this.valueExpression})?`,n=`/${this.tagExpression}`;t=l(this.delimiterLeft),e=l(this.delimiterRight);var r=this.multipleLinesTagEnable?"gs":"gi";this.reSplit=RegExp(`${t}((${i})|(${n}))${e}`,r)}return this}onTag(t){var e=t.match(this.reTag),s=e[1],i="/"===s.charAt(0);if(i&&(s=s.substring(1,s.length)),this.translateTagNameCallback&&(s=this.translateTagNameCallback(s)),this.skipEventFlag=!1,i)this.emit(`-${s}`),this.skipEventFlag||this.emit("-",s),this.lastTagEnd=s;else{var n=function(t,e,s){if(null==t)return[];void 0===e&&(e=h),void 0===s&&(s=",");for(var i=t.split(s),n=0,r=i.length;n<r;n++)i[n]=e(i[n]);return i}(e[3],this.valueConverter);this.emit(`+${s}`,...n),this.skipEventFlag||this.emit("+",s,...n),this.lastTagStart=s}}}const m="[^=]+";class d extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.on("destroy",this.destroy,this)}add(t){return new f(t)}}return d},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexbracketparserplugin=e();
