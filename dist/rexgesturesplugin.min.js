var t,e;t=void 0,e=function(){class t{constructor(t){this.scene=t,t.sys.events.once("destroy",this.destroy,this)}destroy(){this.scene=null}static register(e,s){t.prototype[e]=s}}var e={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}};const s=Phaser.Scene;var i=function(t){return t instanceof s},n=function(t){return null==t||"object"!=typeof t?null:i(t)?t:t.scene&&i(t.scene)?t.scene:t.parent&&t.parent.scene&&i(t.parent.scene)?t.parent.scene:null};const r=Phaser.Game;var o=function(t){return t instanceof r},h=function(t){return null==t||"object"!=typeof t?null:o(t)?t:o(t.game)?t.game:i(t)?t.sys.game:i(t.scene)?t.scene.sys.game:void 0};const a=Phaser.Utils.Objects.GetValue;class c{constructor(t,e){this.setParent(t),this.isShutdown=!1,this.setEventEmitter(a(e,"eventEmitter",!0)),this.parent&&(this.parent===this.scene?this.scene.sys.events.once("shutdown",this.onEnvDestroy,this):this.parent===this.game?this.game.events.once("shutdown",this.onEnvDestroy,this):this.parent.once&&this.parent.once("destroy",this.onParentDestroy,this))}shutdown(t){this.isShutdown||(this.parent&&(this.parent===this.scene?this.scene.sys.events.off("shutdown",this.onEnvDestroy,this):this.parent===this.game?this.game.events.off("shutdown",this.onEnvDestroy,this):this.parent.once&&this.parent.off("destroy",this.onParentDestroy,this)),this.destroyEventEmitter(),this.parent=void 0,this.scene=void 0,this.game=void 0,this.isShutdown=!0)}destroy(t){this.shutdown(t)}onEnvDestroy(){this.destroy(!0)}onParentDestroy(t,e){this.destroy(e)}setParent(t){return this.parent=t,this.scene=n(t),this.game=h(t),this}}Object.assign(c.prototype,e);const u=Phaser.Utils.Objects.GetValue;class d extends c{constructor(t,e){super(t,e),this._isRunning=!1,this.isPaused=!1,this.tickingState=!1,this.setTickingMode(u(e,"tickingMode",1))}boot(){2!==this.tickingMode||this.tickingState||this.startTicking()}shutdown(t){this.isShutdown||(this.stop(),this.tickingState&&this.stopTicking(),super.shutdown(t))}setTickingMode(t){"string"==typeof t&&(t=p[t]),this.tickingMode=t}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking()))}start(){return this.isPaused=!1,this.isRunning=!0,this}pause(){return this.isRunning&&(this.isPaused=!0,this.isRunning=!1),this}resume(){return this.isPaused&&(this.isPaused=!1,this.isRunning=!0),this}stop(){return this.isPaused=!1,this.isRunning=!1,this}complete(){this.isPaused=!1,this.isRunning=!1,this.emit("complete",this.parent,this)}}const p={no:0,lazy:1,always:2};var l=function(t){return void 0!==t.displayWidth?t.displayWidth:t.width},v=function(t){return void 0!==t.displayHeight?t.displayHeight:t.height};const g=Phaser.Geom.Rectangle,f=Phaser.Math.Vector2,m=Phaser.Math.RotateAround,y=Phaser.GameObjects.Container;var E=void 0,w=function(t,e,s){return void 0===e?e=new f:!0===e&&(void 0===P&&(P=new f),e=P),t.getTopLeft?t.getTopLeft(e,s):(e.x=t.x-l(t)*t.originX,e.y=t.y-v(t)*t.originY,D(t,e,s))},b=function(t,e,s){return void 0===e?e=new f:!0===e&&(void 0===P&&(P=new f),e=P),t.getTopRight?t.getTopRight(e,s):(e.x=t.x-l(t)*t.originX+l(t),e.y=t.y-v(t)*t.originY,D(t,e,s))},x=function(t,e,s){return void 0===e?e=new f:!0===e&&(void 0===P&&(P=new f),e=P),t.getBottomLeft?t.getBottomLeft(e,s):(e.x=t.x-l(t)*t.originX,e.y=t.y-v(t)*t.originY+v(t),D(t,e,s))},_=function(t,e,s){return void 0===e?e=new f:!0===e&&(void 0===P&&(P=new f),e=P),t.getBottomRight?t.getBottomRight(e,s):(e.x=t.x-l(t)*t.originX+l(t),e.y=t.y-v(t)*t.originY+v(t),D(t,e,s))},P=void 0,D=function(t,e,s){return void 0===s&&(s=!1),0!==t.rotation&&m(e,t.x,t.y,t.rotation),s&&t.parentContainer&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e),e},S=function(t,e,s,i,n){if(!t)return!1;if(i&&!i(t,e,s))return!1;var r=function(t,e){if(void 0===e?e=new g:!0===e&&(void 0===E&&(E=new g),e=E),t.getBounds&&!(t instanceof y))return t.getBounds(e);var s,i,n,r,o,h,a,c;if(t.parentContainer){var u=t.parentContainer.getBoundsTransformMatrix();w(t,e),u.transformPoint(e.x,e.y,e),s=e.x,i=e.y,b(t,e),u.transformPoint(e.x,e.y,e),n=e.x,r=e.y,x(t,e),u.transformPoint(e.x,e.y,e),o=e.x,h=e.y,_(t,e),u.transformPoint(e.x,e.y,e),a=e.x,c=e.y}else w(t,e),s=e.x,i=e.y,b(t,e),n=e.x,r=e.y,x(t,e),o=e.x,h=e.y,_(t,e),a=e.x,c=e.y;return e.x=Math.min(s,n,o,a),e.y=Math.min(i,r,h,c),e.width=Math.max(s,n,o,a)-e.x,e.height=Math.max(i,r,h,c)-e.y,e}(t,!0);return!(!r.contains(e,s)||n&&!n(t,e,s))},O=function(t,e,s){var i=t.camera;return i?(void 0===s?s={}:!0===s&&(s=T),i===e?(s.x=t.worldX,s.y=t.worldY):i.getWorldPoint(t.x,t.y,s),s):null},T={},j=function(t,e,s,i){return function(t,e,s,i,n){var r,o=t.scene.sys.cameras.main,h=0===t.scrollFactorX&&0===t.scrollFactorY;if(e)return h?s(t,e.x,e.y,i,n):!!(r=O(e,o,!0))&&s(t,r.x,r.y,i,n);for(var a=t.scene.input.manager,c=a.pointersTotal,u=a.pointers,d=0;d<c;d++)if(e=u[d],h){if(s(t,e.x,e.y,i,n))return!0}else{if(!(r=O(e,o,!0)))continue;if(s(t,r.x,r.y,i,n))return!0}return!1}(t,e,S,s,i)};const C=Phaser.Utils.Objects.GetValue;class R extends d{constructor(t,e){var s=n(t);s===t&&(t=void 0),super(s,e),this.gameObject=t,t&&t.setInteractive(C(e,"inputConfig",void 0)),this._enable=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(C(t,"enable",!0)),this.setDetectBounds(),void 0===this.gameObject?this.setDetectBounds(C(t,"bounds",void 0)):this.setDetectBounds(),this.tracerState=N,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,this.isTouchingAnyObject=!1,this}boot(){super.boot(),this.gameObject?this.gameObject.on("pointerdown",this.onPointerDown,this):this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("gameout",this.dragCancel,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.sys.events.once("shutdown",this.destroy,this)}shutdown(t){this.scene&&(this.gameObject||this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("gameout",this.dragCancel,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.sys.events.off("shutdown",this.destroy,this),this.gameObject=void 0,this.bounds=void 0,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,super.shutdown(t))}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||this.dragCancel(),this._enable=t,this}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}setDetectBounds(t){return this.bounds=t,this}toggleEnable(){return this.setEnable(!this.enable),this}onPointerDown(t,e){this.enable&&void 0===this.pointer&&(!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer!==t&&(this.pointer=t,this.pointerCamera=t.camera,this.lastPointer=t,this.movedState=!1,this.tracerState=G,void 0===this.gameObject&&(this.isTouchingAnyObject=e.length>0),this.onDragStart())}onPointerUp(t){this.enable&&(!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer===t&&(this.pointer=void 0,this.pointerCamera=void 0,this.movedState=!1,this.tracerState=N,this.onDragEnd())}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),s=this.pointer===t;!s&&e||(s&&!e?this.onPointerUp(t):(this.movedState||(this.movedState=t.x!==t.downX||t.y!==t.downY),this.movedState&&this.onDrag()))}}dragCancel(){return this.tracerState===G&&this.onDragEnd(),this.pointer=void 0,this.tracerState=N,this}onDragStart(){this.emit("dragstart",this)}onDragEnd(){this.emit("dragend",this)}onDrag(){this.emit("drag",this)}preUpdate(t,e){}postUpdate(t,e){}startTicking(){super.startTicking(),this.scene.sys.events.on("preupdate",this.preUpdate,this),this.scene.sys.events.on("postupdate",this.postUpdate,this)}stopTicking(){super.stopTicking(),this.scene&&(this.scene.sys.events.off("preupdate",this.preUpdate,this),this.scene.sys.events.off("postupdate",this.postUpdate,this))}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=M,this}isPointerInGameObject(t,e,s){var i=this.lastPointer;return!!i&&j(t,i,e,s)}}const N=0,G=1,M="IDLE";function I(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var k={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,s="~";function i(){}function n(t,e,s){this.fn=t,this.context=e,this.once=s||!1}function r(t,e,i,r,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var h=new n(i,r||t,o),a=s?s+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],h]:t._events[a].push(h):(t._events[a]=h,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function h(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),h.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(s?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},h.prototype.listeners=function(t){var e=s?s+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},h.prototype.listenerCount=function(t){var e=s?s+t:t,i=this._events[e];return i?i.fn?1:i.length:0},h.prototype.emit=function(t,e,i,n,r,o){var h=s?s+t:t;if(!this._events[h])return!1;var a,c,u=this._events[h],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,r),!0;case 6:return u.fn.call(u.context,e,i,n,r,o),!0}for(c=1,a=new Array(d-1);c<d;c++)a[c-1]=arguments[c];u.fn.apply(u.context,a)}else{var p,l=u.length;for(c=0;c<l;c++)switch(u[c].once&&this.removeListener(t,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,e);break;case 3:u[c].fn.call(u[c].context,e,i);break;case 4:u[c].fn.call(u[c].context,e,i,n);break;default:if(!a)for(p=1,a=new Array(d-1);p<d;p++)a[p-1]=arguments[p];u[c].fn.apply(u[c].context,a)}}return!0},h.prototype.on=function(t,e,s){return r(this,t,e,s,!1)},h.prototype.once=function(t,e,s){return r(this,t,e,s,!0)},h.prototype.removeListener=function(t,e,i,n){var r=s?s+t:t;if(!this._events[r])return this;if(!e)return o(this,r),this;var h=this._events[r];if(h.fn)h.fn!==e||n&&!h.once||i&&h.context!==i||o(this,r);else{for(var a=0,c=[],u=h.length;a<u;a++)(h[a].fn!==e||n&&!h[a].once||i&&h[a].context!==i)&&c.push(h[a]);c.length?this._events[r]=1===c.length?c[0]:c:o(this,r)}return this},h.prototype.removeAllListeners=function(t){var e;return t?(e=s?s+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=s,h.EventEmitter=h,t.exports=h}(k);var L=I(k.exports);class B extends L{shutdown(){this.removeAllListeners()}destroy(){this.removeAllListeners()}}var A={setEventEmitter(t,e){return void 0===e&&(e=B),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},U=function(t,e,s,i){var n=t&&("object"==typeof t||"function"==typeof t),r=i&&("object"==typeof i||"function"==typeof i);if(!n&&!r)return s;var o=String(e);if(n&&o in t)return t[o];if(r&&o in i)return i[o];if(-1===o.indexOf("."))return s;var h=o.split(".");if(n){var a=X(t,h,s);if(a.found)return a.value}if(r){var c=X(i,h,s);if(c.found)return c.value}return s},X=function(t,e,s){for(var i=t,n=s,r=0,o=e.length;r<o;r++){var h=e[r];if(!i||"object"!=typeof i&&"function"!=typeof i||!(h in i))return Y.found=!1,Y;i=n=i[h]}return Y.found=!0,Y.value=n,Y},Y={};const F=["next","exit","enter"];let V=class{constructor(t){var e=U(t,"states",void 0);e&&this.addStates(e);var s=U(t,"extend",void 0);if(s)for(var i in s)this.hasOwnProperty(i)&&void 0!==this[i]||(this[i]=s[i]);var n=U(t,"eventEmitter",void 0),r=U(t,"EventEmitterClass",void 0);this.setEventEmitter(n,r),this._stateLock=!1,this.resetFromJSON(t)}shutdown(){this.destroyEventEmitter()}destroy(){this.shutdown()}resetFromJSON(t){this.setEnable(U(t,"enable",!0)),this.start(U(t,"start",void 0));var e=U(t,"init",void 0);return e&&e.call(this),this}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}set state(t){if(this.enable&&!this._stateLock&&this._state!==t){if(this._prevState=this._state,this._state=t,this._stateLock=!0,this.emit("statechange",this),null!=this._prevState){var e="exit_"+this._prevState,s=this[e];s&&s.call(this),this.emit(e,this)}if(this._stateLock=!1,null!=this._state){var i="enter_"+this._state,n=this[i];n&&n.call(this),this.emit(i,this)}}}get state(){return this._state}get prevState(){return this._prevState}start(t){return this._start=t,this._prevState=void 0,this._state=t,this}goto(t){return null!=t&&(this.state=t),this}next(){var t,e=this["next_"+this.state];return e&&(t="string"==typeof e?e:e.call(this)),this.goto(t),this}get stateProperties(){return F}addState(t,e){"string"!=typeof t&&(t=(e=t).name);for(var s=this.stateProperties,i=0,n=s.length;i<n;i++){var r=s[i],o=e[r];o&&(this[`${r}_${t}`]=o)}return this}addStates(t){if(Array.isArray(t))for(var e=0,s=t.length;e<s;e++)this.addState(t[e]);else for(var i in t)this.addState(i,t[i]);return this}runMethod(t,e,s,i,n,r){var o=this[t+"_"+this.state];if(o){var h=arguments.length;switch(h){case 1:return o.call(this);case 2:return o.call(this,e);case 3:return o.call(this,e,s);case 4:return o.call(this,e,s,i);case 5:return o.call(this,e,s,i,n);case 6:return o.call(this,e,s,i,n,r)}for(var a=new Array(h-1),c=1;c<h;c++)a[c-1]=arguments[c];return o.apply(this,a)}}};Object.assign(V.prototype,A);var J=function(t,e,s,i,n){void 0===n&&(n=!1);var r=t._events[e];if(!r)return!1;for(var o=0,h=r.length;o<h;o++){var a=r[o];if(a.fn===s&&a.context===i&&a.once===n)return!0}return!1};const z=["next","exit","enter","update","preupdate","postupdate"];class W extends V{shutdown(){this.stopUpdate(),this.stopPreUpdate(),this.stopPostUpdate(),this._scene=void 0,super.shutdown()}resetFromJSON(t){return super.resetFromJSON(t),this._scene=U(t,"scene",void 0),this}get stateProperties(){return z}update(t,e){this.runMethod("update",t,e)}preupdate(t,e){this.runMethod("preupdate",t,e)}postupdate(t,e){this.runMethod("postupdate",t,e)}startUpdate(t){t||(t=this._scene);var e=t.sys.events;return J(e,"update",this.update,this)||(this._scene=t,e.on("update",this.update,this)),this}stopUpdate(){return this._scene?(this._scene.sys.events.off("update",this.update,this),this):this}startPreUpdate(t){t||(t=this._scene);var e=t.sys.events;return J(e,"preupdate",this.preupdate,this)||(this._scene=t,e.on("preupdate",this.preupdate,this)),this}stopPreUpdate(){return this._scene?(this._scene.sys.events.off("preupdate",this.preupdate,this),this):this}startPostUpdate(t){t||(t=this._scene);var e=t.sys.events;return J(e,"postupdate",this.postupdate,this)||(this._scene=t,e.on("postupdate",this.postupdate,this)),this}stopPostUpdate(){return this._scene?(this._scene.sys.events.off("postupdate",this.postupdate,this),this):this}}const Z=Phaser.Utils.Objects.GetValue,H=Phaser.Math.Distance.Between;class $ extends R{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.stop(),s.tapsCount=0,s.x=0,s.y=0,s.worldX=0,s.worldY=0,s.lastPointer=void 0},exit:function(){var t=s.lastPointer;s.x=t.x,s.y=t.y,s.worldX=t.worldX,s.worldY=t.worldY}},BEGIN:{enter:function(){s.start(),s.tapsCount=0,s.emit("tappingstart",s,s.gameObject,s.lastPointer)}},RECOGNIZED:{enter:function(){s.start(),s.emit("tap",s,s.gameObject,s.lastPointer),s.emit(`${s.tapsCount}tap`,s,s.gameObject,s.lastPointer)}}},init:function(){this.state=q},eventEmitter:!1};this.setRecongizedStateObject(new W(i))}resetFromJSON(t){super.resetFromJSON(t),this.setHoldTime(Z(t,"time",250)),this.setTapInterval(Z(t,"tapInterval",200)),this.setDragThreshold(Z(t,"threshold",9)),this.setTapOffset(Z(t,"tapOffset",10));var e=Z(t,"taps",void 0);return void 0!==e?this.setTaps(e):(this.setMaxTaps(Z(t,"maxTaps",void 0)),this.setMinTaps(Z(t,"minTaps",void 0))),this}onDragStart(){switch(this.state){case q:this.state=K;break;case K:var t=this.lastPointer;H(t.upX,t.upY,t.x,t.y)>this.tapOffset&&(this.state=Q,this.state=K);break;case Q:this.state=K}}onDragEnd(){this.state===K&&(this.tapsCount++,this.emit("tapping",this,this.gameObject,this.lastPointer),void 0!==this.maxTaps&&this.tapsCount===this.maxTaps&&(this.state=Q))}onDrag(){this.state!==q&&this.pointer.getDistance()>this.dragThreshold&&(this.state=q)}preUpdate(t,e){if(this.isRunning&&this.enable&&this.state===K){var s=this.lastPointer;s.isDown?t-s.downTime>this.holdTime&&(this.state=q):t-s.upTime>this.tapInterval&&(void 0===this.minTaps||this.tapsCount>=this.minTaps?this.state=Q:this.state=q)}}postUpdate(t,e){this.isRunning&&this.enable&&this.state===Q&&(this.state=q)}get isTapping(){return this.state===Q}get isTapped(){return this.isTapping}setHoldTime(t){return this.holdTime=t,this}setTapInterval(t){return this.tapInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setTapOffset(t){return this.tapOffset=t,this}setMaxTaps(t){return this.maxTaps=t,this}setMinTaps(t){return this.minTaps=t,this}setTaps(t,e){return void 0===e&&(e=t),this.setMinTaps(t).setMaxTaps(e),this}}const q="IDLE",K="BEGIN",Q="RECOGNIZED";var tt=function(t){return null!==t&&"object"==typeof t},et=function(t,e,s,i="."){if(!tt(t))return t;if(function(t){return null==t}(e)||""===e||Array.isArray(e)&&0===e.length)return t;if("string"==typeof e&&-1===e.indexOf(i))return t[e]=s,t;var n=function(t,e){return Array.isArray(t)||(t="string"!=typeof t||""===t.trim()?[]:t.split(e).filter(Boolean)),t}(e,i);if(0===n.length)return t;for(var r=t,o=n.length,h=0;h<o-1;h++){var a=n[h],c=r[a];tt(c)||(r[a]={}),r=r[a]}return r[n[o-1]]=s,t};const st=Phaser.GameObjects.GameObject,it=Phaser.GameObjects.Layer;var nt=function(t){return t instanceof st||t instanceof it};t.register("tap",(function(t,e){return nt(t)||(e=t,t=this.scene),new $(t,e)})),et(window,"RexPlugins.Gestures.Tap",$);const rt=Phaser.Utils.Objects.GetValue;class ot extends R{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.x=0,s.y=0,s.worldX=0,s.worldY=0,s.lastPointer=void 0},exit:function(){var t=s.lastPointer;s.x=t.x,s.y=t.y,s.worldX=t.worldX,s.worldY=t.worldY}},BEGIN:{enter:function(){s.start()},exit:function(){s.stop()}},RECOGNIZED:{enter:function(){s.emit("pressstart",s,s.gameObject,s.lastPointer)},exit:function(){s.emit("pressend",s,s.gameObject,s.lastPointer)}}},init:function(){this.state=ht},eventEmitter:!1};this.setRecongizedStateObject(new W(i))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(rt(t,"threshold",9)),this.setHoldTime(rt(t,"time",251)),this}onDragStart(){this.state=at,0===this.holdTime&&(this.state=ct)}onDragEnd(){this.state=ht}onDrag(){this.state!==ht&&this.pointer.getDistance()>this.dragThreshold&&(this.state=ht)}preUpdate(t,e){this.isRunning&&this.enable&&this.state===at&&t-this.pointer.downTime>=this.holdTime&&(this.state=ct)}get isPressing(){return this.state===ct}get isPressed(){return this.isPressing}setHoldTime(t){return this.holdTime=t,this}setDragThreshold(t){return this.dragThreshold=t,this}}const ht="IDLE",at="BEGIN",ct="RECOGNIZED";t.register("press",(function(t,e){return nt(t)||(e=t,t=this.scene),new ot(t,e)})),et(window,"RexPlugins.Gestures.Press",ot);const ut=Phaser.Utils.Objects.GetValue;class dt extends R{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{},BEGIN:{enter:function(){var t=s.pointer;s.startX=t.x,s.startY=t.y,s.startWorldX=t.worldX,s.startWorldY=t.worldY}},RECOGNIZED:{enter:function(){s.emit("panstart",s,s.gameObject,s.lastPointer)},exit:function(){var t=s.lastPointer;s.endX=t.x,s.endY=t.y;var e=O(t,s.pointerCamera,!0);s.endWorldX=e.x,s.endWorldY=e.y,s.emit("panend",s,s.gameObject,s.lastPointer)}}},init:function(){this.state=pt},eventEmitter:!1};this.setRecongizedStateObject(new W(i))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(ut(t,"threshold",10)),this}onDragStart(){this.state=lt,0===this.dragThreshold&&(this.state=vt)}onDragEnd(){this.state=pt}onDrag(){switch(this.state){case lt:if(this.pointer.getDistance()>=this.dragThreshold){this.state=vt,this.dx=0,this.dy=0,this.dWorldX=0,this.dWorldY=0;var t=this.pointer;this.x=t.x,this.y=t.y,this.worldX=t.worldX,this.worldY=t.worldY}break;case vt:var e=this.pointerCamera,s=this.pointer.position,i=this.pointer.prevPosition;this.dx=s.x-i.x,this.dy=s.y-i.y,this.dWorldX=this.dx/e.zoom,this.dWorldY=this.dy/e.zoom,t=this.pointer,this.x=t.x,this.y=t.y;var n=O(t,e,!0);this.worldX=n.x,this.worldY=n.y,this.emit("pan",this,this.gameObject,this.lastPointer)}}get isPanning(){return this.state===vt}get isPanned(){return this.isPanning}setDragThreshold(t){return this.dragThreshold=t,this}}const pt="IDLE",lt="BEGIN",vt="RECOGNIZED";t.register("pan",(function(t,e){return nt(t)||(e=t,t=this.scene),new dt(t,e)})),et(window,"RexPlugins.Gestures.Pan",dt);const gt=Phaser.Math.Distance.Between,ft=Phaser.Math.Angle.Between;var mt={getDt:function(){var t;return t=this.scene,h(t).loop.delta},getVelocity:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return gt(e.x,e.y,t.x,t.y)/(.001*this.getDt())},getVelocityX:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.x-e.x)/(.001*this.getDt())},getVelocityY:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.y-e.y)/(.001*this.getDt())},getVelocityAngle:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return ft(e.x,e.y,t.x,t.y)}},yt={"up&down":0,"left&right":1,"4dir":2,"8dir":3},Et={};const wt=Phaser.Utils.Objects.GetValue,bt=Phaser.Math.RadToDeg;class xt extends R{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.x=0,s.y=0,s.worldX=0,s.worldY=0},exit:function(){var t=s.lastPointer;s.x=t.x,s.y=t.y,s.worldX=t.worldX,s.worldY=t.worldY}},BEGIN:{enter:function(){s.validDrag=!1}},RECOGNIZED:{enter:function(){s.start(),s.updateDirectionStates(),s.emit("swipe",s,s.gameObject,s.lastPointer)},exit:function(){s.stop(),s.clearDirectionStates()}}},init:function(){this.state=_t},eventEmitter:!1};this.setRecongizedStateObject(new W(i)),this.clearDirectionStates()}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(wt(t,"threshold",10)),this.setVelocityThreshold(wt(t,"velocityThreshold",1e3)),this.setDirectionMode(wt(t,"dir","8dir")),this}onDragStart(){this.state=Pt}onDragEnd(){this.state=_t}onDrag(){this.state===Pt&&(this.validDrag||(this.validDrag=0===this.dragThreshold||this.pointer.getDistance()>=this.dragThreshold),this.validDrag&&this.dragVelocity>this.velocityThreshold&&(this.state=Dt))}postUpdate(t,e){this.isRunning&&this.enable&&this.state===Dt&&(this.state=_t)}get isSwiping(){return this.state===Dt}get isSwiped(){return this.isSwiping}get dragVelocity(){var t;switch(this.dirMode){case 0:t=this.getVelocityY();break;case 1:t=this.getVelocityX();break;default:t=this.getVelocity()}return t}setDragThreshold(t){return this.dragThreshold=t,this}setVelocityThreshold(t){return this.velocityThreshold=t,this}setDirectionMode(t){return"string"==typeof t&&(t=yt[t]),this.dirMode=t,this}updateDirectionStates(){return function(t,e,s){switch(void 0===s?s={}:!0===s&&(s=Et),s.left=!1,s.right=!1,s.up=!1,s.down=!1,t=(t+360)%360,e){case 0:t<180?s.down=!0:s.up=!0;break;case 1:t>90&&t<=270?s.left=!0:s.right=!0;break;case 2:t>45&&t<=135?s.down=!0:t>135&&t<=225?s.left=!0:t>225&&t<=315?s.up=!0:s.right=!0;break;case 3:t>22.5&&t<=67.5?(s.down=!0,s.right=!0):t>67.5&&t<=112.5?s.down=!0:t>112.5&&t<=157.5?(s.down=!0,s.left=!0):t>157.5&&t<=202.5?s.left=!0:t>202.5&&t<=247.5?(s.left=!0,s.up=!0):t>247.5&&t<=292.5?s.up=!0:t>292.5&&t<=337.5?(s.up=!0,s.right=!0):s.right=!0}}(bt(this.getVelocityAngle()),this.dirMode,this),this}clearDirectionStates(){return this.left=!1,this.right=!1,this.up=!1,this.down=!1,this}}Object.assign(xt.prototype,mt);const _t="IDLE",Pt="BEGIN",Dt="RECOGNIZED";t.register("swipe",(function(t,e){return nt(t)||(e=t,t=this.scene),new xt(t,e)})),et(window,"RexPlugins.Gestures.Swipe",xt);var St=function(t){if("object"!=typeof t||null===t)return t;if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e];return t};const Ot=Phaser.Utils.Objects.GetValue,Tt=Phaser.Utils.Array.SpliceOne,jt=Phaser.Math.Distance.Between,Ct=Phaser.Math.Angle.Between;class Rt{constructor(t,e){var s=n(t);s===t&&(t=void 0);var i=s.input.manager.pointersTotal-1;i<2&&s.input.addPointer(2-i),this.scene=s,this.gameObject=t,t&&t.setInteractive(Ot(e,"inputConfig",void 0)),this.setEventEmitter(Ot(e,"eventEmitter",void 0)),this._enable=void 0,this.pointers=[],this.movedState={},this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(Ot(t,"enable",!0)),this.bounds=Ot(t,"bounds",void 0),this.tracerState=Gt,this.pointers.length=0,St(this.movedState),this}boot(){this.gameObject?this.gameObject.on("pointerdown",this.onPointerDown,this):this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("gameout",this.dragCancel,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.sys.events.once("shutdown",this.destroy,this)}shutdown(){this.scene&&(this.destroyEventEmitter(),this.pointers.length=0,St(this.movedState),this.gameObject||this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("gameout",this.dragCancel,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.sys.events.off("shutdown",this.destroy,this),this.scene=void 0,this.gameObject=void 0)}destroy(){this.shutdown()}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||this.dragCancel(),this._enable=t,this}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}onPointerDown(t){if(this.enable&&2!==this.pointers.length&&(!this.bounds||this.bounds.contains(t.x,t.y))&&-1===this.pointers.indexOf(t))switch(this.movedState[t.id]=!1,this.pointers.push(t),this.pointerCamera=t.camera,this.tracerState){case Gt:this.tracerState=Mt,this.onDrag1Start();break;case Mt:this.tracerState=It,this.onDrag2Start()}}onPointerUp(t){if(this.enable&&(!this.bounds||this.bounds.contains(t.x,t.y))){var e=this.pointers.indexOf(t);if(-1!==e)switch(delete this.movedState[t.id],Tt(this.pointers,e),this.tracerState){case Mt:this.tracerState=Gt,this.onDrag1End();break;case It:this.tracerState=Mt,this.onDrag2End(),this.onDrag1Start()}}}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),s=-1!==this.pointers.indexOf(t);if(!s&&e);else if(s&&!e)this.onPointerUp(t);else if(this.movedState[t.id]||(this.movedState[t.id]=t.x!==t.downX||t.y!==t.downY),this.movedState[t.id])switch(this.tracerState){case Mt:this.onDrag1();break;case It:this.onDrag2()}}}dragCancel(){return this.tracerState===It&&this.onDrag2End(),this.pointers.length=0,St(this.movedState),this.tracerState=Gt,this}onDrag1Start(){this.emit("drag1start",this)}onDrag1End(){this.emit("drag1end",this)}onDrag1(){this.emit("drag1",this)}onDrag2Start(){this.emit("drag2start",this)}onDrag2End(){this.emit("drag2end",this)}onDrag2(){this.emit("drag2",this)}get distanceBetween(){if(this.tracerState!==It)return 0;var t=this.pointers[0],e=this.pointers[1];return jt(t.x,t.y,e.x,e.y)}get angleBetween(){if(this.tracerState!==It)return 0;var t=this.pointers[0],e=this.pointers[1];return Ct(t.x,t.y,e.x,e.y)}get drag1Vector(){var t=this.pointers[0];if(t&&this.movedState[t.id]){var e=t.position,s=t.prevPosition;Nt.x=e.x-s.x,Nt.y=e.y-s.y}else Nt.x=0,Nt.y=0;return Nt}get centerX(){if(this.tracerState!==It)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.x+e.x)/2}get centerY(){if(this.tracerState!==It)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.y+e.y)/2}get prevCenterX(){if(this.tracerState!==It)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.x+e.x)/2}get prevCenterY(){if(this.tracerState!==It)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.y+e.y)/2}get movementCenterX(){return this.centerX-this.prevCenterX}get movementCenterY(){return this.centerY-this.prevCenterY}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=kt,this}isPointer0InGameObject(t,e,s){var i=this.pointers[0];return!!i&&j(t,i,e,s)}isPointer1InGameObject(t,e,s){var i=this.pointers[1];return!!i&&j(t,i,e,s)}}Object.assign(Rt.prototype,e);var Nt={};const Gt=0,Mt=1,It=2,kt="IDLE",Lt=Phaser.Utils.Objects.GetValue;class Bt extends Rt{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.prevDistance=void 0,s.scaleFactor=1}},BEGIN:{},RECOGNIZED:{enter:function(){s.emit("pinchstart",s)},exit:function(){s.emit("pinchend",s)}}},init:function(){this.state=At},eventEmitter:!1};this.setRecongizedStateObject(new W(i))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Lt(t,"threshold",0)),this}onDrag2Start(){this.scaleFactor=1,this.prevDistance=this.distanceBetween,this.state=Ut,0===this.dragThreshold&&(this.state=Xt)}onDrag2End(){this.state=At}onDrag2(){switch(this.state){case Ut:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.prevDistance=t,this.state=Xt}break;case Xt:t=this.distanceBetween,this.scaleFactor=t/this.prevDistance,this.emit("pinch",this),this.prevDistance=t}}get isPinching(){return this.state===Xt}get isPinched(){return this.isPinching}setDragThreshold(t){return this.dragThreshold=t,this}}const At="IDLE",Ut="BEGIN",Xt="RECOGNIZED";t.register("pinch",(function(t,e){return nt(t)||(e=t,t=this.scene),new Bt(t,e)})),et(window,"RexPlugins.Gestures.Pinch",Bt);const Yt=Phaser.Math.RotateAround;var Ft=function(t,e,s,i){return Yt(t,e,s,i),t.rotation+=i,t},Vt={};const Jt=Phaser.Utils.Objects.GetValue,zt=Phaser.Math.Angle.WrapDegrees,Wt=Phaser.Math.Angle.ShortestBetween,Zt=Phaser.Math.RadToDeg,Ht=Phaser.Math.DegToRad;class $t extends Rt{constructor(t,e){super(t,e);var s=this,i={states:{IDLE:{enter:function(){s.prevAngle=void 0,s.angle=0}},BEGIN:{},RECOGNIZED:{enter:function(){s.emit("rotatestart",s)},exit:function(){s.emit("rotateend",s)}}},init:function(){this.state=Kt},eventEmitter:!1};this.setRecongizedStateObject(new W(i))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Jt(t,"threshold",0)),this}onDrag2Start(){this.prevAngle=zt(Zt(this.angleBetween)),this.state=Qt,0===this.dragThreshold&&(this.state=te)}onDrag2End(){this.state=Kt}onDrag2(){switch(this.state){case Qt:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=zt(Zt(this.angleBetween));this.angle=Wt(this.prevAngle,t),this.prevAngle=t,this.state=te}break;case te:t=zt(Zt(this.angleBetween)),this.angle=Wt(this.prevAngle,t),this.prevAngle=t,this.emit("rotate",this)}}get isRotating(){return this.state===te}get isRotated(){return this.isRotating}get rotation(){return Ht(this.angle)}setDragThreshold(t){return this.dragThreshold=t,this}}var qt={spinObject:function(t,e){if(!this.isRotation)return this;void 0===e&&(e=this.pointers[0].camera);var s=this.movementCenterX,i=this.movementCenterY,n=function(t,e,s,i){return void 0===i?i={}:!0===i&&(i=Vt),s.getWorldPoint(t,e,i),i}(this.centerX,this.centerY,e,!0),r=n.x,o=n.y,h=this.rotation;if(Array.isArray(t))for(var a=t,c=0,u=a.length;c<u;c++)(t=a[c]).x+=s,t.y+=i,Ft(t,r,o,h);else t.x+=s,t.y+=i,Ft(t,r,o,h);return this}};Object.assign($t.prototype,qt);const Kt="IDLE",Qt="BEGIN",te="RECOGNIZED";t.register("rotate",(function(t,e){return nt(t)||(e=t,t=this.scene),new $t(this.scene,e)})),et(window,"RexPlugins.Gestures.Rotate",$t);class ee extends Phaser.Plugins.ScenePlugin{constructor(e,s){super(e,s),this.add=new t(e)}boot(){this.scene.sys.events.on("destroy",this.destroy,this)}destroy(){this.add.destroy(),super.destroy()}}return ee},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexgesturesplugin=e();
