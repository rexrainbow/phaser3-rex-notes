var e,t;e=void 0,t=function(){var e=function(e,t,i){void 0===i&&(i=[]),i.length=t;for(var r=t;r>0;r--)i[r]=e*(r/t);return i};class t{constructor(e){this.postFXPipeline=e,this.shader=void 0}setShader(e){return this.shader=e,this}getAnotherFrame(e){var t=this.postFXPipeline,i=t.fullFrame1,r=t.fullFrame2;return e===i?r:i}init(e,t){var i=this.postFXPipeline;return void 0===t&&(t=i.fullFrame1),i.copyFrame(e,t),t}draw(e,t){}}class i extends t{draw(e,t){for(var i,r,s,n,l=this.postFXPipeline,o=this.shader,a=e,u=this.getAnotherFrame(a),h=l.pixelWidth/l.renderer.width,p=l.pixelHeight/l.renderer.height,f=0,d=l._quality-1;f<=d;f++)s=(r=l._kernels[f]+.5)*h,n=r*p,l.set2f("uOffset",s,n,o),f<d?(l.bindAndDraw(a,u,!0,!0,o),a=u,u=this.getAnotherFrame(a)):t?(l.bindAndDraw(a,u,!0,!0,o),i=u):l.bindAndDraw(a,null,!0,!0,o);return i}}const r=Phaser.Renderer.WebGL.Pipelines.PostFXPipeline,s=Phaser.Utils.Objects.GetValue;class n extends r{constructor(e){super({name:"rexKawaseBlurFilterPostFx",game:e,renderTarget:!0,fragShader:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n\n// Scene buffer\nuniform sampler2D uMainSampler; \nvarying vec2 outTexCoord;\n\n// Effect parameters\nuniform vec2 uOffset;\n\nvoid main (void) {\n  vec4 color = vec4(0.0);\n\n  // Sample top left pixel\n  color += texture2D(uMainSampler, vec2(outTexCoord.x - uOffset.x, outTexCoord.y + uOffset.y));\n\n  // Sample top right pixel\n  color += texture2D(uMainSampler, vec2(outTexCoord.x + uOffset.x, outTexCoord.y + uOffset.y));\n\n  // Sample bottom right pixel\n  color += texture2D(uMainSampler, vec2(outTexCoord.x + uOffset.x, outTexCoord.y - uOffset.y));\n\n  // Sample bottom left pixel\n  color += texture2D(uMainSampler, vec2(outTexCoord.x - uOffset.x, outTexCoord.y - uOffset.y));\n\n  // Average\n  color *= 0.25;\n\n  gl_FragColor = color;\n}\n"}),this.drawer=new i(this),this._kernels=[0],this._blur=0,this._quality=1,this.pixelWidth=1,this.pixelHeight=1}resetFromJSON(e){var t=s(e,"blur",4);return"number"==typeof t?(this.setBlur(t),this.setQuality(s(e,"quality",3))):this.setKernela(t),this.setPixelSize(s(e,"pixelWidth",1),s(e,"pixelHeight",1)),this}onPreRender(){}onDraw(e){this.drawer.draw(this.drawer.init(e))}get blur(){return this._blur}set blur(t){this._blur!==t&&(this._blur=t,e(this._blur,this._quality,this._kernels))}setBlur(e){return this.blur=e,this}get quality(){return this._quality}set quality(t){this._quality!==t&&(this._quality=t,e(this._blur,this._quality,this._kernels))}setQuality(e){return this.quality=e,this}get kernels(){return this._kernels}set kernels(e){void 0===e&&(e=[0]),this._kernels=e,this._quality=e.length,this._blur=Math.max(...e)}setKernela(e){return this.kernels=e,this}setPixelWidth(e){return this.pixelWidth=e,this}setPixelHeight(e){return this.pixelHeight=e,this}setPixelSize(e,t){return void 0===t&&(t=e),this.pixelWidth=e,this.pixelHeight=t,this}}const l=Phaser.Game;var o=function(e){return e instanceof l};const a=Phaser.Scene;var u=function(e){return e instanceof a},h=function(e,t,i){var r;(r=e,null==r||"object"!=typeof r?null:o(r)?r:o(r.game)?r.game:u(r)?r.sys.game:u(r.scene)?r.scene.sys.game:void 0).renderer.pipelines.addPostPipeline(t,i)};const p=Phaser.Utils.Array.SpliceOne;class f extends Phaser.Plugins.BasePlugin{setPostPipelineClass(e,t){return this.PostFxPipelineClass=e,this.postFxPipelineName=t,this}start(){this.game.events.once("destroy",this.destroy,this),h(this.game,this.postFxPipelineName,this.PostFxPipelineClass)}add(e,t){return function(e,t,i){void 0===i&&(i={}),e.setPostPipeline(t);var r=e.postPipelines[e.postPipelines.length-1];return r.resetFromJSON(i),i.name&&(r.name=i.name),r}(e,this.PostFxPipelineClass,t)}remove(e,t){return function(e,t,i){if(void 0===i)for(var r=(s=e.postPipelines).length-1;r>=0;r--)(l=s[r])instanceof t&&(l.destroy(),p(s,r));else{r=0;for(var s,n=(s=e.postPipelines).length;r<n;r++){var l;(l=s[r])instanceof t&&l.name===i&&(l.destroy(),p(s,r))}}}(e,this.PostFxPipelineClass,t),this}get(e,t){return function(e,t,i){if(void 0===i){for(var r=[],s=0,n=(l=e.postPipelines).length;s<n;s++)(o=l[s])instanceof t&&r.push(o);return r}var l;for(s=0,n=(l=e.postPipelines).length;s<n;s++){var o;if((o=l[s])instanceof t&&o.name===i)return o}}(e,this.PostFxPipelineClass,t)}}var d=function(e){return null==e||""===e||0===e.length};return Phaser.Utils.Objects.GetValue,function(e,t,i,r){if(void 0===r&&(r="."),"object"==typeof e)if(d(t)){if(null==i)return;"object"==typeof i&&(e=i)}else{"string"==typeof t&&(t=t.split(r));var s=t.pop(),n=function(e,t,i){var r=e;if(d(t));else{var s;"string"==typeof t&&(t=t.split("."));for(var n=0,l=t.length;n<l;n++){var o;null!=r[s=t[n]]&&"object"==typeof r[s]||(o=n===l-1?void 0===i?{}:i:{},r[s]=o),r=r[s]}}return r}(e,t);n[s]=i}}(window,"RexPlugins.Pipelines.KawaseBlurFilterPostFx",n),class extends f{constructor(e){super(e),this.setPostPipelineClass(n,"rexKawaseBlurFilterPostFx")}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexkawaseblurpipelineplugin=t();
