var e,t;e=void 0,t=function(){const e=Phaser.Game;var t=function(t){return t instanceof e};const s=Phaser.Scene;var i=function(e){return e instanceof s},n=function(e){return null==e||"object"!=typeof e?null:t(e)?e:t(e.game)?e.game:i(e)?e.sys.game:i(e.scene)?e.scene.sys.game:void 0};const r=Phaser.Renderer.WebGL.Pipelines.PostFXPipeline,p=Phaser.Math.Vector2,o=Phaser.Utils.Objects.GetValue;class a extends r{constructor(e){super({name:"rexWarpPostFx",game:e,renderTarget:!0,fragShader:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n\n// Scene buffer\nuniform sampler2D uMainSampler; \nvarying vec2 outTexCoord;\n\n// Effect parameters\nuniform vec2 texSize;\nuniform vec2 amplitude;\nuniform vec2 frequency;\nuniform vec2 speed;\nuniform float time;\n\n\nvoid main (void) {\n  vec2 dxy = frequency/texSize;\n  vec2 r = amplitude/texSize;\n  vec2 spd = speed/texSize;\n  vec2 angle = (outTexCoord / dxy) + (spd*time);\n  vec2 tc = (vec2(cos(angle.x),sin(angle.y)) * r) + outTexCoord;\n  gl_FragColor = texture2D(uMainSampler, tc);\n}\n"}),this.frequencyX=10,this.frequencyY=10,this.amplitudeX=10,this.amplitudeY=10,this.speedEnable=!1,this.now=0,this.speed=new p(0,0)}resetFromJSON(e){var t=o(e,"frequency",10);this.setFrequency(o(e,"frequencyX",t),o(e,"frequencyY",t));var s=o(e,"amplitude",10);this.setAmplitude(o(e,"amplitudeX",s),o(e,"amplitudeY",s));var i=o(e,"speed",0);return this.setSpeed(o(e,"speedX",i),o(e,"speedY",i)),this.setSpeedEnable(o(e,"speedEnable",0!==this.speedX||0!==this.speedY)),this}onPreRender(){var e;this.speedEnable&&(this.now+=(e=this.game,n(e).loop.delta)),this.set2f("frequency",this.frequencyX,this.frequencyY),this.set2f("amplitude",this.amplitudeX,this.amplitudeY),this.set2f("speed",this.speed.x,this.speed.y),this.set1f("time",this.now),this.set2f("texSize",this.renderer.width,this.renderer.height)}setFrequencyX(e){return this.frequencyX=e,this}setFrequencyY(e){return this.frequencyY=e,this}setFrequency(e,t){return void 0===t&&(t=e),this.frequencyX=e,this.frequencyY=t,this}get frequency(){return(this.frequencyX+this.frequencyY)/2}set frequency(e){this.frequencyX=e,this.frequencyY=e}setAmplitudeX(e){return this.amplitudeX=e,this}setAmplitudeY(e){return this.amplitudeY=e,this}setAmplitude(e,t){return void 0===t&&(t=e),this.amplitudeX=e,this.amplitudeY=t,this}get amplitude(){return(this.amplitudeX+this.amplitudeY)/2}set amplitude(e){this.amplitudeX=e,this.amplitudeY=e}setSpeedX(e){return this.speedX=e,this}setSpeedY(e){return this.speed.y=e,this}get speedX(){return this.speed.x}set speedX(e){this.speed.x=e}get speedY(){return this.speed.y}set speedY(e){this.speed.y=e}setSpeed(e,t){return void 0===t&&(t=e),this.speedX=e,this.speedY=t,this}setSpeedEnable(e){return void 0===e&&(e=!0),this.speedEnable=e,this}}const u=Phaser.Utils.Array.SpliceOne;class d extends Phaser.Plugins.BasePlugin{setPostPipelineClass(e,t){return this.PostFxPipelineClass=e,this.postFxPipelineName=t,this}start(){var e,t,s;this.game.events.once("destroy",this.destroy,this),e=this.game,t=this.postFxPipelineName,s=this.PostFxPipelineClass,n(e).renderer.pipelines.addPostPipeline(t,s)}add(e,t){return function(e,t,s){void 0===s&&(s={}),e.setPostPipeline(t);var i=e.postPipelines[e.postPipelines.length-1];return i.resetFromJSON(s),s.name&&(i.name=s.name),i}(e,this.PostFxPipelineClass,t)}remove(e,t){return function(e,t,s){if(void 0===s)for(var i=(n=e.postPipelines).length-1;i>=0;i--)(p=n[i])instanceof t&&(p.destroy(),u(n,i));else{i=0;for(var n,r=(n=e.postPipelines).length;i<r;i++){var p;(p=n[i])instanceof t&&p.name===s&&(p.destroy(),u(n,i))}}e.hasPostPipeline=e.postPipelines.length>0}(e,this.PostFxPipelineClass,t),this}get(e,t){return function(e,t,s){if(void 0===s){for(var i=[],n=0,r=(p=e.postPipelines).length;n<r;n++)(o=p[n])instanceof t&&i.push(o);return i}var p;for(n=0,r=(p=e.postPipelines).length;n<r;n++){var o;if((o=p[n])instanceof t&&o.name===s)return o}}(e,this.PostFxPipelineClass,t)}}var l=function(e){return null==e||""===e||0===e.length};return function(e,t,s,i){if(void 0===i&&(i="."),"object"==typeof e)if(l(t)){if(null==s)return;"object"==typeof s&&(e=s)}else{"string"==typeof t&&(t=t.split(i));var n=t.pop(),r=function(e,t,s){var i=e;if(l(t));else{var n;"string"==typeof t&&(t=t.split("."));for(var r=0,p=t.length;r<p;r++){var o;null!=i[n=t[r]]&&"object"==typeof i[n]||(o=r===p-1?void 0===s?{}:s:{},i[n]=o),i=i[n]}}return i}(e,t);r[n]=s}}(window,"RexPlugins.Pipelines.WarpPostFx",a),class extends d{constructor(e){super(e),this.setPostPipelineClass(a,"rexWarpPostFx")}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexwarppipelineplugin=t();
